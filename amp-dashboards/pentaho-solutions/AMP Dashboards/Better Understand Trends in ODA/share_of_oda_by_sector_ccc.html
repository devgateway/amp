


<!-- The dashboard layout -->
<div id="dashboard" style="width:100%;">
    <div id="filter_object_container">
      <div id="filter_object" style="width:900px;height:40px;padding:5px 5px 5px 5px;border-bottom: 1px solid black;margin: 0px auto;">
        <div style="float:left;padding:5px 10px 2px 12px;font-family:Verdana,Arial,sans-serif;font-size: 8pt;font-weight:bold;">CDF.i18n("msg_region")</div> <div style="float:left;width:300px;" id="regionSelect_object"></div>
        <!--<div style="float:left;padding:5px 10px 2px 12px;font-family:Verdana,Arial,sans-serif;font-size: 8pt;font-weight:bold;">CDF.i18n("msg_sector")</div> <div style="float:left;" id="sectorSelect_object"></div>-->
        <div style="float:left;padding:5px 10px 2px 12px;font-family:Verdana,Arial,sans-serif;font-size: 8pt;font-weight:bold;">CDF.i18n("msg_program")</div> <div style="float:left;" id="programSelect_object"></div>
        <div style="float:left;padding:0px 2px 2px 12px;font-family:Verdana,Arial,sans-serif;font-size: 8pt;font-weight:bold;"><button id="apply" style="font-size:10pt;font-weight:bold;padding:0px;float:right;">CDF.i18n("msg_reset")</div>
      </div>
    </div>
    <div id="first_section" style="float:left;margin:10px 10x 10px 10px;">
      <div id="firstChartTypeSelect_object">
        <span class="#format" id="firstChartTypeSelector">
            <input type="radio" id="first_bar" name="first_chart_type"  CHECKED value="bar"/><label for="first_bar">CDF.i18n("msg_bar1")</label>
            <input type="radio" id="first_data" name="first_chart_type" value="data"/><label for="first_data">CDF.i18n("msg_data1")</label>
        </span>
      </div>
      <div id="first_chart_bar"></div>
      <div id="first_chart_data" style="width:400px;"></div>
    </div>
    <div id="dateRangeSelector" style="clear:both;">
      <div id="startYearSelect_object" style="padding:10px 10px 10px 10px">
      </div>
      <div id="endYearSelect_object" style="padding:10px 10px 10px 10px">
      </div>
    </div>
</div>
<script language="javascript" type="text/javascript">

//Filter criteria
var regionParameter = "";
var programParameter = "";
var currency = Dashboards.getQueryParameter("currency");
var type_of_funding = Dashboards.getQueryParameter("type_of_funding");
var type_of_funding_translation = "Actual Disbursements";
$(window).ready(function(){
type_of_funding_translation = (type_of_funding == "Actual Commitments") ? Dashboards.i18nSupport.prop("msg_actual_commitments"): Dashboards.i18nSupport.prop("msg_actual_disbursements");
});
var startYear = "2001";
var endYear = "2011";
var dateRangeInitialized = false;

var processParameters = function(){
	console.log("Processing parameters.");
    var regionValues = $("#regionSelect_object > select").val();
    regionValues = regionValues != null ? regionValues : [];
    //Reset global parameter
    regionParameter = "";
    $.each(regionValues,
      function(idx, value){ 
        regionParameter = (regionParameter == "" ? "": regionParameter + ",") + "[Region].[" + value +"]";
      });

    var programValues = $("#programSelect_object > select").val();
    programValues = programValues != null ? programValues : [];
    //Reset global parameter
    programParameter = "";
    $.each(programValues,
      function(idx, value){ 
        programParameter = (programParameter == "" ? "": programParameter + ",") + "[National Program Level 1].[" + value +"]";
      });

    //Reset global parameter

	console.log("regionParameter:" + regionParameter);
	if (regionParameter != "" || programParameter != "")
	{
		if(regionParameter == "") regionParameter = "[Regions].Members";
		if(programParameter == "") programParameter = "[National Program Level 1].Members";
	}
    first_data_table.chartDefinition.colTypes = [];
    first_data_table.chartDefinition.colFormats = [];
    first_data_table.chartDefinition.colHeaders = [];
  };
  
var multiSelectConfig;
$(window).ready(function() {
  multiSelectConfig = {
        noneSelectedText: Dashboards.i18nSupport.prop("msg_select_options"),
        checkAllText: Dashboards.i18nSupport.prop("msg_check_all"),
        uncheckAllText: Dashboards.i18nSupport.prop("msg_uncheck_all"),
        selectedText: Dashboards.i18nSupport.prop("msg_selected_option")
     }
});  

var getParameters = function() {
  return regionParameter + programParameter;
}

var listeners = ["startYear","endYear","regionParameter","programParameter"];
var parameters = [["startYear","startYear"], ["endYear","endYear"], ["regionParameter","regionParameter"], ["programParameter","programParameter"], ["currency","currency"], ["type_of_funding","type_of_funding"], ["type_of_funding_translation","type_of_funding_translation"]];

</script>


<script language="javascript" type="text/javascript">

var first_bar_chart = jQuery.extend(true, {}, seminal_chart);
first_bar_chart.type = "cccBarChart";
first_bar_chart.name = "first_bar_chart";
first_bar_chart.htmlObject = "first_chart_bar";
first_bar_chart.chartDefinition.dataAccessId = function() {return getParameters() == "" ? "first_chart_mdx" : "first_chart_mdx_params"};
first_bar_chart.chartDefinition.crosstabMode = true;
first_bar_chart.chartDefinition.seriesInRows = false;
first_bar_chart.chartDefinition.yAxisSize = 320;
first_bar_chart.chartDefinition.legend = false;
first_bar_chart.chartDefinition.width = 700;
first_bar_chart.chartDefinition.height = 400;
first_bar_chart.chartDefinition.valueFormat = function f(value){return (Math.round(value*100)/100) + "%";};
first_bar_chart.chartDefinition.path = "/AMP Dashboards/Better Understand Trends in ODA/share_of_oda_by_sector_ccc.cda";
first_bar_chart.chartDefinition.title =  function() { return Dashboards.i18nSupport.prop("msg_percentage_by_primary_sector") + " (" + startYear + "-" + endYear + ")"};
first_bar_chart.chartDefinition.orientation = "horizontal";
first_bar_chart.chartDefinition.extensionPoints = [["yAxisLabel_font","10px sans-serif"]];
first_bar_chart.listeners = listeners;
first_bar_chart.parameters = parameters;
first_bar_chart.preExecution = processParameters;

var first_data_table = jQuery.extend(true, {}, seminal_data_table);
first_data_table.chartDefinition.dataAccessId = "first_chart_mdx";
first_data_table.chartDefinition.path = "/AMP Dashboards/Better Understand Trends in ODA/share_of_oda_by_sector_ccc.cda";
first_data_table.htmlObject = "first_chart_data";
first_data_table.name = "first_data_table";
first_data_table.listeners = listeners;
first_data_table.parameters = parameters;
first_data_table.chartDefinition.colTypes = [];
first_data_table.chartDefinition.colFormats = [];


</script>

<script language="javascript">
    var cType = "bar";
		$("#firstChartTypeSelector").buttonset();
    $("#first_chart_data").hide();
		$("#firstChartTypeSelector").click(function (){
        var oldCType = cType;
        cType = $("#firstChartTypeSelector :radio:checked").val();
        $("#first_chart_" + oldCType).fadeOut('fast', function(){$("#first_chart_" + cType).fadeIn();});
			});

  var resizeLayout = function() {
		$("#dashboard").height($(window).height()-30);
		$("#dashboard").width($(document.body).width()-5);
//		$("#first_section").height($("#dashboard").height());
		$("#first_section").width($("#dashboard").width()-100);
    
		first_bar_chart.chartDefinition.width = $("#first_section").width()-20;
		first_data_table.chartDefinition.width = $("#first_section").width()-20;
	}
	var initialized = false;
	
$(window).resize(resizeLayout);
$(window).ready(function() {
  var components = [regionSelect, programSelect, startYearSelect, endYearSelect, first_bar_chart, first_data_table];
  Dashboards.init(components);
  resizeLayout();
  initialized = true;
  setTimeout(applyDateRange, 500);
  
});
  $("#apply").click(function () {
  regionParameter = "";
  programParameter = "";
  startYear = "2001";
  endYear = "2009";    
  first_data_table.chartDefinition.colTypes = [];
  first_data_table.chartDefinition.colFormats = [];
  first_data_table.chartDefinition.colHeaders = [];
  Dashboards.resetAll();
  setTimeout(applyDateRange, 500);
});
  
var applyDateRange = function() {
    console.log("applyDateRange");
    if (dateRangeInitialized){
      $("#dateRangeSelector > div > select").selectToUISlider(
        {
          labels: $("#startYearSelect_object option").length,
          sliderOptions: {
            stop: function(e,ui) {
                setTimeout(function() {
                  var updateComponent = (ui.handle.id == "handle_endYear") ? endYearSelect : startYearSelect;
                  first_data_table.chartDefinition.colTypes = [];
                  first_data_table.chartDefinition.colFormats = [];
                  first_data_table.chartDefinition.colHeaders = [];
                  Dashboards.processChange(updateComponent);
                  }, 1000);
            }
          }
        }
      ).hide();
    }
    else
      setTimeout(applyDateRange, 500);
};

</script>
	<style>
    .ui-button-text { font-size:8pt;}
    .ui-state-active { font-weight:bold;}
    .ui-widget { font-size:8pt;}
    </style>

