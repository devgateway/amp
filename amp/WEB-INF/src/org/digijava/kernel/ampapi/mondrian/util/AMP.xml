<?xml version="1.0"?>
<!DOCTYPE AMP [
<!ENTITY mondriandtd SYSTEM "mondrian.dtd">]>
<Schema name="AMP">
	<Dimension name="AMP Sector">
		<Hierarchy hasAll="true" allMemberName="All Level 0 Sectors" primaryKey="amp_sector_id" name="Level 0 Sector">
			<Table name="mondrian_sectors@@locale@@" />
			<Level name="Level 0 Sector" type="Integer" column="level0_sector_id" nameColumn="level0_sector_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Level 1 Sectors" primaryKey="amp_sector_id" name="Level 1 Sector">
			<Table name="mondrian_sectors@@locale@@" />
			<Level name="Level 1 Sector" type="Integer" column="level1_sector_id" nameColumn="level1_sector_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Level 2 Sectors" primaryKey="amp_sector_id" name="Level 2 Sector">
			<Table name="mondrian_sectors@@locale@@" />
			<Level name="Level 2 Sector" type="Integer" column="level2_sector_id" nameColumn="level2_sector_name" />
		</Hierarchy>
	</Dimension>

	<Dimension name="AMP Organization" >
		<Hierarchy hasAll="true" allMemberName="All Orgs" primaryKey="amp_org_id" name="Organization Hierarchy">
			<Table name="mondrian_organizations@@locale@@" />
			<Level name="Organization Type Name" uniqueMembers="true" type="Integer" column="amp_org_type_id" nameColumn="org_type_name" />
			<Level name="Organization Group Name" uniqueMembers="true" type="Integer" column="amp_org_grp_id" nameColumn="org_grp_name" />
			<Level name="Organization Name" uniqueMembers="true" type="Integer" column="amp_org_id" nameColumn="org_name" />
			<Level name="Organization Code" type="Integer" column="amp_org_id" nameColumn="org_code" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Orgs" primaryKey="amp_org_id" name="Organization Name">
			<Table name="mondrian_organizations@@locale@@" />
			<Level name="Organization Name" uniqueMembers="true" type="Integer" column="amp_org_id" nameColumn="org_name" />
			<Level name="Organization Code" type="Integer" column="amp_org_id" nameColumn="org_code" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Types" primaryKey="amp_org_id" name="Organization Type Name">
			<Table name="mondrian_organizations@@locale@@" />
			<Level name="Organization Type Name" uniqueMembers="true" type="Integer" column="amp_org_type_id" nameColumn="org_type_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Groups" primaryKey="amp_org_id" name="Organization Group Name">
			<Table name="mondrian_organizations@@locale@@" />
			<Level name="Organization Group Name" uniqueMembers="true" type="Integer" column="amp_org_grp_id" nameColumn="org_grp_name" />
		</Hierarchy>
	</Dimension>

	<Dimension name="AMP Program" >
		<Hierarchy hasAll="true" allMemberName="All Programs" primaryKey="amp_theme_id">
			<Table name="mondrian_programs@@locale@@" />
			<Level name="Program Level 0 Name" type="Integer" column="id0" nameColumn="name0" />
			<Level name="Program Level 1 Name" type="Integer" column="id1" nameColumn="name1" />
			<Level name="Program Level 2 Name" type="Integer" column="id2" nameColumn="name2" />
			<Level name="Program Level 3 Name" type="Integer" column="id3" nameColumn="name3" />
			<Level name="Program Level 4 Name" type="Integer" column="id4" nameColumn="name4" />
			<Level name="Program Level 5 Name" type="Integer" column="id5" nameColumn="name5" />
			<Level name="Program Level 6 Name" type="Integer" column="id6" nameColumn="name6" />
			<Level name="Program Level 7 Name" type="Integer" column="id7" nameColumn="name7" />
			<Level name="Program Level 8 Name" type="Integer" column="id8" nameColumn="name8" />
		</Hierarchy>
	</Dimension>

	<Cube name="Donor Funding">
		<Table name="mondrian_fact_table" />

		<Dimension name="Project Title" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Activities" primaryKey="amp_activity_id" name="Project Title">
				<Table name="mondrian_activity_texts@@locale@@" />
				<Level name="Project Title" column="amp_activity_id" type="Integer" nameColumn="name" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Approval Status" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Approval Statuses" primaryKey="amp_activity_id">
				<Table name="mondrian_activity_texts@@locale@@" />
				<Level name="Approval Status" column="approval_status" nameColumn="approval_status" />
			</Hierarchy>
		</Dimension>

		<Dimension name="AMP ID" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All AMP IDs" primaryKey="amp_activity_id" name="AMP ID">
				<Table name="mondrian_activity_texts@@locale@@" />
				<Level name="AMP ID" column="amp_activity_id" type="Integer" nameColumn="amp_id" uniqueMembers="true" /> <!-- not sure about uniqueMembers -->
			</Hierarchy>
		</Dimension>

		<Dimension name="Location" foreignKey="location_id">
			<Hierarchy hasAll="true" allMemberName="All Locations" name="Locations" uniqueKeyLevelName="Location" primaryKey="id">
				<Table name="mondrian_locations@@locale@@" />
				<Level name="Country Name" column="country_id" type="Integer" nameColumn="country_name" />
				<Level name="Region Name" column="region_id" type="Integer" nameColumn="region_name" />
				<Level name="Zone Name" column="zone_id" type="Integer" nameColumn="zone_name" />
				<Level name="District Name" column="district_id" type="Integer" nameColumn="district_name" />
				<Level name="Location" column="id" type="Integer" nameColumn="location_name" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Locations" name="Country" primaryKey="id">
				<Table name="mondrian_locations@@locale@@" />
				<Level name="Country Name" column="country_id" type="Integer" nameColumn="country_name" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Locations" name="Region Name" primaryKey="id">
				<Table name="mondrian_locations@@locale@@" />
				<Level name="Region Name" column="region_id" type="Integer" nameColumn="region_name" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Locations" name="LocationsDuplicate" uniqueKeyLevelName="Location" primaryKey="id">
				<Table name="mondrian_locations@@locale@@" />
				<Level name="Country Name" column="country_id" type="Integer" nameColumn="country_name" >
					<Property name="default" column="id" type="Integer"/>
					<Property name="countryId" column="country_id" type="Integer"/>
					<Property name="regionId" column="region_id" type="Integer"/>
					<Property name="zoneId" column="zone_id" type="Integer"/>
					<Property name="districtId" column="district_id" type="Integer"/>
					<Property name="locationId" column="id" type="Integer"/>
				</Level>
				<Level name="Region Name" column="region_id" type="Integer" nameColumn="region_name" />
				<Level name="Zone Name" column="zone_id" type="Integer" nameColumn="zone_name" />
				<Level name="District Name" column="district_id" type="Integer" nameColumn="district_name" />
				<Level name="Location" column="id" type="Integer" nameColumn="location_name" >
				</Level>
			</Hierarchy>
		</Dimension>

		<Dimension name="Secondary Sector" foreignKey="secondary_sector_id">
			<Hierarchy hasAll="true" allMemberName="All Secondary Sectors" primaryKey="amp_sector_id">
				<Table name="mondrian_sectors@@locale@@" alias="secondary_sector_table" />
				<Level name="Secondary Sector" type="Integer" column="level0_sector_id" nameColumn="level0_sector_name" />
				<Level name="Secondary Sector Sub-sector" type="Integer" column="level1_sector_id" nameColumn="level1_sector_name" />
				<Level name="Secondary Sector Sub-sub-sector" type="Integer" column="level2_sector_id" nameColumn="level2_sector_name" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Tertiary Sector" foreignKey="tertiary_sector_id">
			<Hierarchy hasAll="true" allMemberName="All Tertiary Sectors" primaryKey="amp_sector_id">
				<Table name="mondrian_sectors@@locale@@" alias="tertiary_sector_table" />
				<Level name="Tertiary Sector" type="Integer" column="level0_sector_id" nameColumn="level0_sector_name" />
				<Level name="Tertiary Sector Sub-sector" type="Integer" column="level1_sector_id" nameColumn="level1_sector_name" />
				<Level name="Tertiary Sector Sub-sub-sector" type="Integer" column="level2_sector_id" nameColumn="level2_sector_name" />
			</Hierarchy>
		</Dimension>

		<DimensionUsage name="Donor Agency" source="AMP Organization" caption="Donor Agency" foreignKey="donor_id" />
		<DimensionUsage name="Implementing Agency" source="AMP Organization" caption="Implementing Agency" foreignKey="ia_org_id" />
		<DimensionUsage name="Executing Agency" source="AMP Organization" caption="Executing Agency" foreignKey="ea_org_id" />
		<DimensionUsage name="Beneficiary Agency" source="AMP Organization" caption="Beneficiary Agency" foreignKey="ba_org_id" />
		<DimensionUsage name="Responsible Organization" source="AMP Organization" caption="Responsible Agency" foreignKey="ro_org_id" />

		<DimensionUsage name="Primary Program" source="AMP Program" caption="Primary Program" foreignKey="primary_program_id" />
		<DimensionUsage name="Secondary Program" source="AMP Program" caption="Secondary Program" foreignKey="secondary_program_id" />
		<DimensionUsage name="Tertiary Program" source="AMP Program" caption="Tertiary Program" foreignKey="tertiary_program_id" />
		<DimensionUsage name="National Objectives" source="AMP Program" caption="National Objectives" foreignKey="national_objectives_program_id" />

		<DimensionUsage name="Primary Sector"   source="AMP Sector" caption="Primary Sector" foreignKey="primary_sector_id" />
		<DimensionUsage name="Secondary Sector" source="AMP Sector" caption="Secondary Sector" foreignKey="secondary_sector_id" />
		<DimensionUsage name="Tertiary Sector"  source="AMP Sector" caption="Tertiary Sector" foreignKey="tertiary_sector_id" />
		
		<Dimension name="Dates" type="TimeDimension" foreignKey="date_code">
			<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Dates">
				<Table name="mondrian_dates" />
				<Level name="Year" column="year_code" levelType="TimeYears" type="Integer" />
				<Level name="Quarter" column="quarter_code" ordinalColumn="quarter_code" nameColumn="quarter_name" levelType="TimeQuarters" type="Integer"/>
				<Level name="Month" column="month_code" ordinalColumn="month_code" nameColumn="month_name" levelType="TimeMonths" type="Integer" />
				<!-- Level name="Day" column="day_of_month" ordinalColumn="day_of_month" nameColumn="day_of_month_name" levelType="TimeDays" type="Integer" /-->
				<Level name="Date" column="day_code" ordinalColumn="day_code" nameColumn="full_date" type="Integer" levelType="TimeDays">
					<Property name="year_code" column="year_code" type="Integer"/>
					<Property name="date_code" column="day_code" type="Integer"/>
				</Level>
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Year">
			  <Table name="mondrian_dates" />
			  <Level name="Year" column="year_code" levelType="TimeYears" type="Integer" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Quarter">
			  <Table name="mondrian_dates" />
			  <Level name="Quarter" column="quarter_code" ordinalColumn="quarter_code" nameColumn="quarter_name" levelType="TimeQuarters" type="Integer"/>
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Month">
			  <Table name="mondrian_dates" />
			  <Level name="Month" column="month_code" ordinalColumn="month_code" nameColumn="month_name" levelType="TimeMonths" type="Integer" />
			</Hierarchy>
		</Dimension>
		
		<Measure name="Actual Commitments" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE WHEN mondrian_fact_table.transaction_type=0 AND mondrian_fact_table.adjustment_type=@@actual@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>
		<Measure name="Actual Disbursements" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN mondrian_fact_table.transaction_type=1 AND mondrian_fact_table.adjustment_type=@@actual@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>
		<Measure name="Actual Expenditures" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN mondrian_fact_table.transaction_type=2 AND mondrian_fact_table.adjustment_type=@@actual@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>		
		<Measure name="Planned Commitments" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE WHEN mondrian_fact_table.transaction_type=0 AND mondrian_fact_table.adjustment_type=@@planned@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>
		<Measure name="Planned Disbursements" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN mondrian_fact_table.transaction_type=1 AND mondrian_fact_table.adjustment_type=@@planned@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>
		<Measure name="Planned Expenditures" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN mondrian_fact_table.transaction_type=2 AND mondrian_fact_table.adjustment_type=@@planned@@
					THEN "mondrian_fact_table".transaction_exch_@@currency@@ ELSE 0 END
				</SQL>
			</MeasureExpression>
		</Measure>				
	</Cube>
 </Schema>