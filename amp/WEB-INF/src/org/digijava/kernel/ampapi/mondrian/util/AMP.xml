<?xml version="1.0"?>
<!DOCTYPE AMP [
<!ENTITY mondriandtd SYSTEM "mondrian.dtd">]>
<Schema name="AMP">
	<Dimension name="AMP Sector">
		<Hierarchy hasAll="true" allMemberName="All Level 0 Sectors" primaryKey="amp_sector_id" name="Level 0 Sector">
			<SectorViewDefinition />
			<Level name="Level 0 Sector" type="Integer" column="level0_sector_id" nameColumn="level0_sector_name" />
		</Hierarchy>
		<!-- adding temporarily support for ID sectors => need to revise if a better approach, like automatically generate ids instead of names based on a flag, can be done -->
		<Hierarchy hasAll="true" allMemberName="All Level 0 Sectors" primaryKey="amp_sector_id" name="Level 0 Sector Id">
			<SectorViewDefinition />
			<Level name="Level 0 Sector Id" type="Integer" column="level0_sector_id"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 1 Sectors" primaryKey="amp_sector_id" name="Level 1 Sector">
			<SectorViewDefinition />
			<Level name="Level 1 Sector" type="Integer" column="level1_sector_id" nameColumn="level1_sector_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Level 1 Sectors" primaryKey="amp_sector_id" name="Level 1 Sector Id">
			<SectorViewDefinition />
			<Level name="Level 1 Sector Id" type="Integer" column="level1_sector_id" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 2 Sectors" primaryKey="amp_sector_id" name="Level 2 Sector">
			<SectorViewDefinition />
			<Level name="Level 2 Sector" type="Integer" column="level2_sector_id" nameColumn="level2_sector_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Level 2 Sectors" primaryKey="amp_sector_id" name="Level 2 Sector Id">
			<SectorViewDefinition />
			<Level name="Level 2 Sector Id" type="Integer" column="level2_sector_id"/>
		</Hierarchy>				
	</Dimension>

	<Dimension name="AMP Organization" >
		<Hierarchy hasAll="true" allMemberName="All Orgs" primaryKey="amp_org_id" name="Organization Name">
			<Table name="mondrian_organizations@@locale@@@@nopledges@@" />
			<Level name="Organization Name" uniqueMembers="true" type="Integer" column="amp_org_id" nameColumn="org_name" />
			<Level name="Organization Code" type="Integer" column="amp_org_id" nameColumn="org_code" translated="false"/>
			<Level name="Organization Acronym" type="Integer" column="amp_org_id" nameColumn="org_acronym" translated="false"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Orgs" primaryKey="amp_org_id" name="Organization Id">
			<Table name="mondrian_organizations@@locale@@@@nopledges@@" />
			<Level name="Organization Id" uniqueMembers="true" type="Integer" column="amp_org_id"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Types" primaryKey="amp_org_id" name="Organization Type Name">
			<Table name="mondrian_organizations@@locale@@@@nopledges@@" />
			<Level name="Organization Type Name" uniqueMembers="true" type="Integer" column="amp_org_type_id" nameColumn="org_type_name" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Groups" primaryKey="amp_org_id" name="Organization Group Name">
			<Table name="mondrian_organizations@@locale@@@@nopledges@@" />
			<Level name="Organization Group Name" uniqueMembers="true" type="Integer" column="amp_org_grp_id" nameColumn="org_grp_name" />
		</Hierarchy>
	</Dimension>

	<Dimension name="AMP Program" >
		<Hierarchy hasAll="true" allMemberName="All Level 0" primaryKey="amp_theme_id" name="Level 0">
			<ProgramViewDefinition />
			<Level name="Level 0 Name" type="Integer" column="id0" nameColumn="name0" translated="false"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 0" primaryKey="amp_theme_id" name="Level 0 Id">
			<ProgramViewDefinition />
			<Level name="Level 0 Id" type="Integer" column="id0" translated="false"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Normal" primaryKey="amp_theme_id" name="Normal">
			<ProgramViewDefinition />
			<Level name="Level 1 Name" type="Integer" column="id1" nameColumn="name1" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Normal" primaryKey="amp_theme_id" name="Normal Id">
			<ProgramViewDefinition />
			<Level name="Level 1 Id" type="Integer" column="id1"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Detail" primaryKey="amp_theme_id" name="Detail">
			<ProgramViewDefinition />
			<Level name="Detail Name" type="Integer" column="amp_theme_id" nameColumn="name" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Detail" primaryKey="amp_theme_id" name="Detail Id">
			<ProgramViewDefinition />
			<Level name="Detail Id" type="Integer" column="amp_theme_id"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 1" primaryKey="amp_theme_id" name="Level 1">
			<ProgramViewDefinition />
			<Level name="Level 1 Name" type="Integer" column="id1" nameColumn="name1" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 1" primaryKey="amp_theme_id" name="Level 1 Id">
			<ProgramViewDefinition />
			<Level name="Level 1 Id" type="Integer" column="id1"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 2" primaryKey="amp_theme_id" name="Level 2">
			<ProgramViewDefinition />
			<Level name="Level 2 Name" type="Integer" column="id2" nameColumn="name2" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 2" primaryKey="amp_theme_id" name="Level 2 Id">
			<ProgramViewDefinition />
			<Level name="Level 2 Id" type="Integer" column="id2"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 3" primaryKey="amp_theme_id" name="Level 3">
			<ProgramViewDefinition />
			<Level name="Level 3 Name" type="Integer" column="id3" nameColumn="name3" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 3" primaryKey="amp_theme_id" name="Level 3 Id">
			<ProgramViewDefinition />
			<Level name="Level 3 Id" type="Integer" column="id3"/>
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 4" primaryKey="amp_theme_id" name="Level 4">
			<ProgramViewDefinition />
			<Level name="Level 4 Name" type="Integer" column="id4" nameColumn="name4" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 4" primaryKey="amp_theme_id" name="Level 4 Id">
			<ProgramViewDefinition />
			<Level name="Level 4 Id" type="Integer" column="id4"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 5" primaryKey="amp_theme_id" name="Level 5">
			<ProgramViewDefinition />
			<Level name="Level 5 Name" type="Integer" column="id5" nameColumn="name5" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 5" primaryKey="amp_theme_id" name="Level 5 Id">
			<ProgramViewDefinition />
			<Level name="Level 5 Id" type="Integer" column="id5"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 6" primaryKey="amp_theme_id" name="Level 6">
			<ProgramViewDefinition />
			<Level name="Level 6 Name" type="Integer" column="id6" nameColumn="name6" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 6" primaryKey="amp_theme_id" name="Level 6 Id">
			<ProgramViewDefinition />
			<Level name="Level 6 Id" type="Integer" column="id6"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 7" primaryKey="amp_theme_id" name="Level 7">
			<ProgramViewDefinition />
			<Level name="Level 7 Name" type="Integer" column="id7" nameColumn="name7" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 7" primaryKey="amp_theme_id" name="Level 7 Id">
			<ProgramViewDefinition />
			<Level name="Level 7 Id" type="Integer" column="id7"/>
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Level 8" primaryKey="amp_theme_id" name="Level 8">
			<ProgramViewDefinition />
			<Level name="Level 8 Name" type="Integer" column="id8" nameColumn="name8" />
		</Hierarchy>
		
		<Hierarchy hasAll="true" allMemberName="All Level 8" primaryKey="amp_theme_id" name="Level 8 Id">
			<ProgramViewDefinition />
			<Level name="Level 8 Id" type="Integer" column="id8"/>
		</Hierarchy>
		
	</Dimension>

	<Dimension name="Category Value">
		<Hierarchy hasAll="true" allMemberName="All Values" primaryKey="acv_id" name="Category Name">
			<Table name="mondrian_category_values@@locale@@" />
			<Level name="Category Name" column="acv_id" type="Integer" nameColumn="acv_name"/>
		</Hierarchy>
	</Dimension>
		
	<Dimension name="Hardcoded Texts">
		<Hierarchy hasAll="true" allMemeberName="All Values" primaryKey="id" name="Hardcoded Text">
			<Table name="mondrian_generic_texts@@locale@@" />
			<Level name="Hardcoded Text" column="id" type="Integer" nameColumn="val" />
		</Hierarchy>
	</Dimension>
		
	<Dimension name="AMP Date" type="TimeDimension">
		<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Dates">
			@@mondrian_date_source1@@
			<Level name="Year" column="year_code@@calendar@@" nameColumn="year_name@@calendar@@" levelType="TimeYears" type="Integer" translated="false" />
			<Level name="Quarter" column="quarter_code@@calendar@@" ordinalColumn="quarter_code@@calendar@@" nameColumn="quarter_name@@calendar@@" levelType="TimeQuarters" type="Integer" translated="false" />
			<Level name="Month" column="month_code@@calendar@@" ordinalColumn="month_code@@calendar@@" nameColumn="month_name@@calendar@@" levelType="TimeMonths" type="Integer"  translated="false" />
			<!-- Level name="Day" column="day_of_month" ordinalColumn="day_of_month" nameColumn="day_of_month_name" levelType="TimeDays" type="Integer" /-->
			<Level name="Date" column="day_code" ordinalColumn="day_code" nameColumn="full_date" type="Integer" levelType="TimeDays" translated="false" >
				<Property name="year_code@@calendar@@" column="year_code@@calendar@@" type="Integer"/>
				<Property name="date_code" column="day_code" type="Integer"/>
			</Level>
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Year">
		  @@mondrian_date_source2@@
		  <Level name="Year" column="year_code@@calendar@@" nameColumn="year_name@@calendar@@" levelType="TimeYears" type="Integer" translated="false" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Quarter">
		  @@mondrian_date_source3@@
		  <Level name="Quarter" column="quarter_code@@calendar@@" ordinalColumn="quarter_code@@calendar@@" nameColumn="quarter_name@@calendar@@" levelType="TimeQuarters" type="Integer" translated="false" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Periods" primaryKey="day_code" name="Month">
		  @@mondrian_date_source4@@
		  <Level name="Month" column="month_code@@calendar@@" ordinalColumn="month_code@@calendar@@" nameColumn="month_name@@calendar@@" levelType="TimeMonths" type="Integer" translated="false" />
		</Hierarchy>
	</Dimension>
	
	<Dimension name="Entity Texts">
		<Hierarchy hasAll="true" allMemberName="All Project Title" primaryKey="amp_activity_id" name="Project Title">
			<Table name="mondrian_activity_texts@@locale@@" />
			<Level name="Project Title" column="amp_activity_id" type="Integer" nameColumn="name" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Team" primaryKey="amp_activity_id" name="Team">
			<Table name="mondrian_activity_texts@@locale@@" />
			<Level name="Team Id" column="team_id" type="Integer" visible="false"/> 
			<Level name="Team" column="team_id" type="String" nameColumn="team_name"/> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Activity Created By" primaryKey="amp_activity_id" name="Activity Created By">
			<Table name="mondrian_activity_texts@@locale@@" />
			<Level name="Activity Created By" column="creator_id" type="String" nameColumn="creator_name" /> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Activity Updated By" primaryKey="amp_activity_id" name="Activity Updated By">
			<Table name="mondrian_activity_texts@@locale@@" />
			<Level name="Activity Updated By" column="modifier_id" type="String" nameColumn="modifier_name" /> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Activity Approved By" primaryKey="amp_activity_id" name="Activity Approved By">
			<Table name="mondrian_activity_texts@@locale@@" />
			<Level name="Activity Approved By" column="approved_id" type="String" nameColumn="approver_name" /> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Government Approval Procedures" primaryKey="amp_activity_id" name="Government Approval Procedures">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Government Approval Procedures" column="governmentapprovalprocedures_id" type="String" nameColumn="governmentapprovalprocedures_text" /> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Joint Criteria" primaryKey="amp_activity_id" name="Joint Criteria">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Joint Criteria" column="jointcriteria_id" type="String" nameColumn="jointcriteria_text" /> 
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All Indirect On Budget" primaryKey="amp_activity_id" name="Indirect On Budget">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Indirect On Budget" column="iob_id" type="String" nameColumn="iob_text" /> 
		</Hierarchy>
			
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Implementation Level" primaryKey="amp_activity_id">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Implementation Level" column="impl_level_id" type="String" nameColumn="impl_level_name" />
		</Hierarchy>
			
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Implementation Location" primaryKey="amp_activity_id">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Implementation Location" column="impl_location_id" type="String" nameColumn="impl_location_name" />
		</Hierarchy>

		<Hierarchy hasAll="true" allMemberName="All On/Off/Treasury Budget" primaryKey="amp_activity_id" name="On/Off/Treasury Budget">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="On/Off/Treasury Budget" column="on_off_budget_id" type="String" nameColumn="on_off_budget_name" /> 
		</Hierarchy>		
		
		<Hierarchy hasAll="true" allMemberName="All Humanitarian Aid" primaryKey="amp_activity_id" name="Humanitarian Aid">
			<Table name="mondrian_activity_trn_texts@@locale@@" />
			<Level name="Humanitarian Aid" column="humanitarian_aid_id" type="String" nameColumn="humanitarian_aid_name" /> 
		</Hierarchy>		
		
	</Dimension>
	
	<Dimension name="AMP Location">
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Country" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="Country" column="country_id" type="Integer" nameColumn="country_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Region" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="Region" column="region_id" type="Integer" nameColumn="region_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Region Id" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="Region Id" column="region_id" type="Integer" nameColumn="region_id" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Zone" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="Zone" column="zone_id" type="Integer" nameColumn="zone_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="District" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="District" column="district_id" type="Integer" nameColumn="district_name" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="GeoCode" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="GeoId" column="id" type="String" nameColumn="geo_code" />
		</Hierarchy>
		<Hierarchy hasAll="true" allMemberName="All Locations" name="Specified Location" primaryKey="id">
			<Table name="mondrian_locations@@locale@@" />
			<Level name="Specified Location" column="id" type="String" nameColumn="location_name" />			
		</Hierarchy>
	</Dimension>
	
	<Cube name="Donor Funding">
		<Table name="@@mondrian_fact_table@@" >
			<SQL dialect="generic"><![CDATA[@@filteredActivities@@]]> </SQL>
		</Table>

		<DimensionUsage name="Activity Texts" source="Entity Texts" foreignKey="entity_id" />
		<DimensionUsage name="Pledge Texts" source="Entity Texts" foreignKey="entity_id" />
		
		<DimensionUsage name="Activity Status" source="Category Value" foreignKey="status_id" />
		<DimensionUsage name="Pledge Status" source="Category Value" foreignKey="status_id" />
		<DimensionUsage name="PledgeModalities" source="Category Value" foreignKey="modality_id" />
		<DimensionUsage name="Modalities" source="Category Value" foreignKey="modality_id" />
		<DimensionUsage name="Type of Cooperation" source="Category Value" foreignKey="type_of_cooperation_id" />
		<DimensionUsage name="Type of Implementation" source="Category Value" foreignKey="type_of_implementation_id" />
		<DimensionUsage name="Procurement System" source="Category Value" foreignKey="procurement_system_id" />
		<DimensionUsage name="Funding Status" source="Category Value" foreignKey="funding_status_id" />
		<DimensionUsage name="Mode of Payment" source="Category Value" foreignKey="mode_of_payment_id" />
		<DimensionUsage name="Financing Instrument" source="Category Value" foreignKey="financing_instrument_id" />
		<DimensionUsage name="Type Of Assistance" source="Category Value" foreignKey="terms_of_assistance_id" />
		<DimensionUsage name="Pledges Type Of Assistance" source="Category Value" foreignKey="terms_of_assistance_id" />
		<DimensionUsage name="Pledges Aid Modality" source="Category Value" foreignKey="modality_id" />
		<DimensionUsage name="Disaster Response Marker" source="Hardcoded Texts" foreignKey="disaster_response" />
		
		<Dimension name="Related Projects" foreignKey="related_entity_id">
			<Hierarchy hasAll="true" allMemberName="All Related Projects" primaryKey="amp_activity_id" name="Related Projects">
				<Table name="mondrian_activity_texts@@locale@@" />
				<Level name="Related Projects" column="amp_activity_id" type="Integer" nameColumn="name" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Related Pledges" foreignKey="related_entity_id">
			<Hierarchy hasAll="true" allMemberName="All Related Pledges" primaryKey="amp_activity_id" name="Related Pledges">
				<Table name="mondrian_activity_texts@@locale@@" />
				<Level name="Related Pledges" column="amp_activity_id" type="Integer" nameColumn="name" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Activity Dates" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Original Completion Date" primaryKey="amp_activity_id" name="Original Completion Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Original Completion Date" column="original_comp_date_code" type="Integer" nameColumn="original_comp_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Final Date for Contracting" primaryKey="amp_activity_id" name="Final Date for Contracting">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Final Date for Contracting" column="contracting_date_code" type="Integer" nameColumn="contracting_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Final Date for Disbursements" primaryKey="amp_activity_id" name="Final Date for Disbursements">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Final Date for Disbursements" column="disbursments_date_code" type="Integer" nameColumn="disbursments_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Proposed Start Date" primaryKey="amp_activity_id" name="Proposed Start Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Proposed Start Date" column="proposed_start_date_code" type="Integer" nameColumn="proposed_start_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Actual Start Date" primaryKey="amp_activity_id" name="Actual Start Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Actual Start Date" column="actual_start_date_code" type="Integer" nameColumn="actual_start_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Proposed Approval Date" primaryKey="amp_activity_id" name="Proposed Approval Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Proposed Approval Date" column="proposed_approval_date_code" type="Integer" nameColumn="proposed_approval_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Actual Approval Date" primaryKey="amp_activity_id" name="Actual Approval Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Actual Approval Date" column="actual_approval_date_code" type="Integer" nameColumn="actual_approval_date" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Actual Completion Date" primaryKey="amp_activity_id" name="Actual Completion Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Actual Completion Date" column="actual_completion_date_code" type="Integer" nameColumn="actual_completion_date" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Current Completion Date" primaryKey="amp_activity_id" name="Current Completion Date"> <!-- synonym for Actual Completion Date -->
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Current Completion Date" column="actual_completion_date_code" type="Integer" nameColumn="actual_completion_date" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Proposed Completion Date" primaryKey="amp_activity_id" name="Proposed Completion Date">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Proposed Completion Date" column="proposed_completion_date_code" type="Integer" nameColumn="proposed_completion_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Activity Created On" primaryKey="amp_activity_id" name="Activity Created On">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Activity Created On" column="date_created_code" type="Integer" nameColumn="date_created" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Activity Updated On" primaryKey="amp_activity_id" name="Activity Updated On">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Activity Updated On" column="date_updated_code" type="Integer" nameColumn="date_updated" />
			</Hierarchy>
			
		</Dimension>
		
		<Dimension name="Activity Fixed Texts" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Activity Id" primaryKey="amp_activity_id" name="Activity Id">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Activity Id" column="amp_activity_id" type="Integer"/>
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Activity Id" primaryKey="amp_activity_id" name="Constant">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Constant" column="constant" type="String"/>
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Internal Use Id" primaryKey="amp_activity_id" name="Internal Use Id">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Internal Use Id" column="amp_activity_id" type="Integer"/>
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Approval Statuses" primaryKey="amp_activity_id" name="Approval Status">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Approval Status" columnName="approval_status" column="approval_status_key" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All AMP IDs" primaryKey="amp_activity_id" name="AMP ID">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="AMP ID" column="amp_activity_id" type="String" nameColumn="amp_id" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Government Agreement Number" primaryKey="amp_activity_id" name="Government Agreement Number">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Government Agreement Number" column="amp_activity_id" type="String" nameColumn="gov_agreement_number" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Budget Code Project Id" primaryKey="amp_activity_id" name="Budget Code Project Id">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Budget Code Project Id" column="amp_activity_id" type="String" nameColumn="budget_code_project_id" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Draft" primaryKey="amp_activity_id" name="Draft">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Draft" column="amp_activity_id" type="String" nameColumn="draft" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All FY" primaryKey="amp_activity_id" name="FY">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="FY" column="amp_activity_id" type="String" nameColumn="fy" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Vote" primaryKey="amp_activity_id" name="Vote">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Vote" column="amp_activity_id" type="String" nameColumn="vote" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Sub-Vote" primaryKey="amp_activity_id" name="Sub-Vote">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Sub-Vote" column="amp_activity_id" type="String" nameColumn="subvote" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project Code" primaryKey="amp_activity_id" name="Project Code">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project Code" column="amp_activity_id" type="String" nameColumn="project_code" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Ministry Code" primaryKey="amp_activity_id" name="Ministry Code">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Ministry Code" column="amp_activity_id" type="String" nameColumn="ministry_code" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Cris Number" primaryKey="amp_activity_id" name="Cris Number">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Cris Number" column="amp_activity_id" type="String" nameColumn="cris_number" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project Implementing Unit" primaryKey="amp_activity_id" name="Project Implementing Unit">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project Implementing Unit" column="amp_activity_id" type="String" nameColumn="prj_implementation_unit" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project has been approved by IMAC" primaryKey="amp_activity_id" name="Project has been approved by IMAC">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project has been approved by IMAC" column="amp_activity_id" type="String" nameColumn="imac_approved" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Government is member of project steering committee" primaryKey="amp_activity_id" name="Government is member of project steering committee">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Government is member of project steering committee" column="amp_activity_id" type="String" nameColumn="national_oversight" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project is on budget" primaryKey="amp_activity_id" name="Project is on budget">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project is on budget" column="amp_activity_id" type="String" nameColumn="on_budget" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Project is on parliament" primaryKey="amp_activity_id" name="Project is on parliament">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project is on parliament" column="amp_activity_id" type="String" nameColumn="on_parliament" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Project disburses directly into the Government single treasury account" primaryKey="amp_activity_id" name="Project disburses directly into the Government single treasury account">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project disburses directly into the Government single treasury account" column="amp_activity_id" type="String" nameColumn="on_treasure" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Project uses national financial management systems" primaryKey="amp_activity_id" name="Project uses national financial management systems">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project uses national financial management systems" column="amp_activity_id" type="String" nameColumn="national_financial_management" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Project uses national procurement systems" primaryKey="amp_activity_id" name="Project uses national procurement systems">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project uses national procurement systems" column="amp_activity_id" type="String" nameColumn="national_procurement" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Project uses national audit systems" primaryKey="amp_activity_id" name="Project uses national audit systems">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Project uses national audit systems" column="amp_activity_id" type="String" nameColumn="national_audit" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="Proposed Project Life" primaryKey="amp_activity_id" name="Proposed Project Life">
				<Table name="mondrian_activity_fixed_texts" />
				<Level name="Proposed Project Life" column="amp_activity_id" type="Integer" nameColumn="proposed_project_life" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Activity Long Texts" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Project Description" primaryKey="amp_activity_id" name="Project Description">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Project Description" column="amp_activity_id" type="String" nameColumn="descr_body" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Objective" primaryKey="amp_activity_id" name="Objective">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Objective" column="amp_activity_id" type="String" nameColumn="objectives_body" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Results" primaryKey="amp_activity_id" name="Results">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Results" column="amp_activity_id" type="String" nameColumn="results_body" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Purpose" primaryKey="amp_activity_id" name="Purpose">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Purpose" column="amp_activity_id" type="String" nameColumn="purpose_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project Comments" primaryKey="amp_activity_id" name="Project Comments">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Project Comments" column="amp_activity_id" type="String" nameColumn="projectcomments_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Project Impact" primaryKey="amp_activity_id" name="Project Impact">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Project Impact" column="amp_activity_id" type="String" nameColumn="project_impact_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Equal Opportunity" primaryKey="amp_activity_id" name="Equal Opportunity">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Equal Opportunity" column="amp_activity_id" type="String" nameColumn="equalopportunity_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Environment" primaryKey="amp_activity_id" name="Environment">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Environment" column="amp_activity_id" type="String" nameColumn="environment_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Minorities" primaryKey="amp_activity_id" name="Minorities">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Minorities" column="amp_activity_id" type="String" nameColumn="minorities_body" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Program Description" primaryKey="amp_activity_id" name="Program Description">
				<Table name="mondrian_activity_long_texts@@locale@@" />
				<Level name="Program Description" column="amp_activity_id" type="String" nameColumn="program_description_body" />
			</Hierarchy>
			
		</Dimension>			
		
		<Dimension name="Component" foreignKey="component_id">
			<Hierarchy hasAll="true" allMemberName="All Component Names" name="Component Name" primaryKey="amp_component_id">
				<Table name="mondrian_components@@locale@@" />
				<Level name="Component Name" column="amp_component_id" type="Integer" nameColumn="component_name" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Component Descriptions" name="Component Description" primaryKey="amp_component_id">
				<Table name="mondrian_components@@locale@@" />
				<Level name="Component Description" column="amp_component_id" type="Integer" nameColumn="component_description" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Component Type Names" name="Component Type Name" primaryKey="amp_component_id">
				<Table name="mondrian_components@@locale@@" />
				<Level name="Component Type Name" column="component_type_id" type="Integer" nameColumn="component_type_name" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Component Type Codes" name="Component Type Code" primaryKey="amp_component_id">
				<Table name="mondrian_components@@locale@@" />
				<Level name="Component Type Code" column="component_type_id" type="Integer" nameColumn="component_type_code" />
			</Hierarchy>
		</Dimension>
		
		<Dimension name="Agreement" foreignKey="agreement_id">
			<Hierarchy hasAll="true" allMemberName="All Agreement Codes" name="Agreement Code" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Code" column="amp_agreement_id" type="Integer" nameColumn="agreement_code" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Agreement Title + Codes" name="Agreement Title + Code" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Title + Code" column="amp_agreement_id" type="Integer" nameColumn="agreement_title_code" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Agreement Close Dates" name="Agreement Close Date" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Close Date" column="close_date_code" type="Integer" nameColumn="close_date" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Agreement Signature Dates" name="Agreement Signature Date" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Signature Date" column="signature_date_code" type="Integer" nameColumn="signature_date" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Agreement Effective Dates" name="Agreement Effective Date" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Effective Date" column="effective_date_code" type="Integer" nameColumn="effective_date" />
			</Hierarchy>

			<Hierarchy hasAll="true" allMemberName="All Agreement Parlimentary Approval Dates" name="Agreement Parlimentary Approval Date" primaryKey="amp_agreement_id">
				<Table name="mondrian_agreements@@locale@@" />
				<Level name="Agreement Parlimentary Approval Date" column="parliamentary_date_code" type="Integer" nameColumn="parliamentary_date" />
			</Hierarchy>
		</Dimension>
		
		<Dimension name="Activity Currency Amounts" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All Proposed Project Amount" primaryKey="amp_activity_id" name="Proposed Project Amount">
				<Table name="mondrian_activity_currency_numbers" />
				<Level name="Proposed Project Amount" type="Numeric" column="ppc_transaction_exch_@@currency@@" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Revised Project Amount" primaryKey="amp_activity_id" name="Revised Project Amount">
				<Table name="mondrian_activity_currency_numbers" />
				<Level name="Revised Project Amount" type="Numeric" column="rpc_transaction_exch_@@currency@@" />
			</Hierarchy>
			
			<Hierarchy hasAll="true" allMemberName="All Forecast Execution Rate" primaryKey="entity_id" name="Forecast Execution Rate">
				<View alias="v_forecast_execution_rate">
					<SQL dialect="generic">
						<![CDATA[
							SELECT v_actual_disbursements_by_entity_id.amp_activity_id AS entity_id,
								CASE WHEN v_actual_disbursements_by_entity_id.total_actual_disbursements IS NULL OR v_most_recent_mtef_by_entity_id.total_most_recent_mtef IS NULL OR v_most_recent_mtef_by_entity_id.total_most_recent_mtef = 0 THEN @@undefined_amount@@ ELSE
									100.0 * v_actual_disbursements_by_entity_id.total_actual_disbursements / v_most_recent_mtef_by_entity_id.total_most_recent_mtef END
								AS fer
							FROM
(SELECT macn.amp_activity_id, SUM(mft.transaction_exch_@@currency@@) AS total_actual_disbursements 
FROM 
	mondrian_activity_currency_numbers macn
		JOIN @@mondrian_fact_table@@ mft ON 
			mft.entity_id = macn.amp_activity_id 
			AND transaction_type = 1 + @@transaction_type_gap@@
			AND adjustment_type = @@actual@@ AND src_role = 'DN'
		GROUP BY macn.amp_activity_id) 
	AS v_actual_disbursements_by_entity_id LEFT JOIN
(select entity_id, SUM(most_recent_mtef) AS total_most_recent_mtef FROM
(select entity_id, funding_id, display_date_code, CASE WHEN pipeline IS NULL THEN projection ELSE pipeline END AS most_recent_mtef FROM 
(SELECT entity_id, funding_id, display_date_code, 
	(SELECT sum(transaction_exch_@@currency@@) FROM @@mondrian_fact_table@@ temp WHERE temp.entity_id = v_mtef_by_type_funding_id.entity_id AND temp.funding_id = v_mtef_by_type_funding_id.funding_id AND temp.display_date_code = v_mtef_by_type_funding_id.display_date_code AND src_role='DN' AND temp.transaction_type = 3 + @@transaction_type_gap@@ AND temp.adjustment_type = @@pipelinemtefacv@@) AS pipeline,
	(SELECT sum(transaction_exch_@@currency@@) FROM @@mondrian_fact_table@@ temp2 WHERE temp2.entity_id = v_mtef_by_type_funding_id.entity_id AND temp2.funding_id = v_mtef_by_type_funding_id.funding_id AND temp2.display_date_code = v_mtef_by_type_funding_id.display_date_code AND src_role='DN' AND temp2.transaction_type = 3 + @@transaction_type_gap@@ AND temp2.adjustment_type = @@projectionmtefacv@@) AS projection
	FROM 
(select distinct entity_id, funding_id, display_date_code from @@mondrian_fact_table@@ WHERE transaction_type = 3 + @@transaction_type_gap@@) AS v_mtef_by_type_funding_id
) AS v_mtef_by_funding_id_year_type
) AS v_mtef_by_funding_id_year
GROUP BY entity_id) AS v_most_recent_mtef_by_entity_id
ON 
	v_actual_disbursements_by_entity_id.amp_activity_id = v_most_recent_mtef_by_entity_id.entity_id 
	AND v_most_recent_mtef_by_entity_id.total_most_recent_mtef > 0
						]]>
					</SQL>
				</View>
				<Level name="Forecast Execution Rate" type="Numeric" column="fer" />
			</Hierarchy>
		</Dimension>
			
		<Dimension name="Activity Total Amounts" foreignKey="entity_id">
			<Hierarchy hasAll="true" allMemberName="All" primaryKey="amp_activity_id" 
						name="Total Amounts">
				<View alias='v_total_@@adj_name@@_@@trn_name@@'>
					<!-- full outer join or union are not working properly in MonetDB -->
					<SQL dialect="generic">
						<![CDATA[
						SELECT "mondrian_activity_fixed_texts"."amp_activity_id", COALESCE((
							SELECT sum("@@mondrian_fact_table@@".transaction_exch_@@currency@@)
												FROM "@@mondrian_fact_table@@"
												WHERE (@@mondrian_fact_table@@.transaction_type=@@trn_type@@) AND (@@mondrian_fact_table@@.adjustment_type=@@adj_id@@) 
												AND @@report_totals_filter@@
												AND "@@mondrian_fact_table@@"."entity_id" = "mondrian_activity_fixed_texts"."amp_activity_id"), 0) AS "Total_@@adj_name@@_@@trn_name@@"
						FROM "mondrian_activity_fixed_texts"
						]]>
					</SQL>
				</View>
				<Level name="Total Amount" type="Numeric" column="Total_Amount" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All" primaryKey="amp_activity_id" 
						name="Grand Total Filtered Amounts" visible="false">
				<View alias='v_grand_total_@@adj_name@@_@@trn_name@@'>
					<SQL dialect="generic">
						<![CDATA[
						SELECT "mondrian_activity_fixed_texts"."amp_activity_id", (
							SELECT sum("@@mondrian_fact_table@@".transaction_exch_@@currency@@)
												FROM "@@mondrian_fact_table@@"
												WHERE (@@mondrian_fact_table@@.transaction_type=@@trn_type@@) AND (@@mondrian_fact_table@@.adjustment_type=@@adj_id@@)
												AND (src_role='DN') 
												AND (@@filteredActivities@@) 
												) AS "Total_Grand_@@adj_name@@_@@trn_name@@"
						FROM "mondrian_activity_fixed_texts"
						]]>
					</SQL>
				</View>
				<Level name="Grand Total Amount" type="Numeric" column="Grand_Total_Amount" />
			</Hierarchy>
		</Dimension>
		
		<DimensionUsage name="Location" source="AMP Location" foreignKey="location_id" />
		<DimensionUsage name="Pledges Location" source="AMP Location" foreignKey="location_id" />
		
		<DimensionUsage name="Donor Agency" source="AMP Organization" foreignKey="donor_id" />
		<DimensionUsage name="Pledges Donor Agency" source="AMP Organization" foreignKey="donor_id" />
		<DimensionUsage name="Component Funding Organization" source="AMP Organization" foreignKey="donor_id" />
		
		<DimensionUsage name="Implementing Agency" source="AMP Organization" foreignKey="ia_org_id" />
		<DimensionUsage name="Executing Agency" source="AMP Organization" foreignKey="ea_org_id" />
		<DimensionUsage name="Beneficiary Agency" source="AMP Organization" foreignKey="ba_org_id" />
		<DimensionUsage name="Responsible Organization" source="AMP Organization" foreignKey="ro_org_id" />
		<DimensionUsage name="Contracting Agency" source="AMP Organization" foreignKey="ca_org_id" />
		<DimensionUsage name="Regional Group" source="AMP Organization" foreignKey="rg_org_id" />
		<DimensionUsage name="Sector Group" source="AMP Organization" foreignKey="sg_org_id" />

		<DimensionUsage name="Primary Program" source="AMP Program" foreignKey="primary_program_id" typeName="Primary Program" />
		<DimensionUsage name="Secondary Program" source="AMP Program" foreignKey="secondary_program_id" typeName="Secondary Program" />
		<DimensionUsage name="Tertiary Program" source="AMP Program" foreignKey="tertiary_program_id" typeName="Tertiary Program" />
		<DimensionUsage name="National Objectives" source="AMP Program" foreignKey="national_objectives_program_id" typeName="National Plan Objective" />

		<DimensionUsage name="Pledges Primary Program" source="AMP Program" foreignKey="primary_program_id" typeName="Primary Program" />
		<DimensionUsage name="Pledges Secondary Program" source="AMP Program" foreignKey="secondary_program_id" typeName="Secondary Program" />
		<DimensionUsage name="Pledges Tertiary Program" source="AMP Program" foreignKey="tertiary_program_id" typeName="Tertiary Program" />
		<DimensionUsage name="Pledges National Objectives" source="AMP Program" foreignKey="national_objectives_program_id" typeName="National Planning Objective" />

		<DimensionUsage name="Primary Sector"   source="AMP Sector" foreignKey="primary_sector_id" typeName="Primary" />
		<DimensionUsage name="Secondary Sector" source="AMP Sector" foreignKey="secondary_sector_id" typeName="Secondary" />
		<DimensionUsage name="Tertiary Sector"  source="AMP Sector" foreignKey="tertiary_sector_id" typeName="Tertiary" />
		
		<DimensionUsage name="Pledge Primary Sector"	source="AMP Sector" foreignKey="primary_sector_id" typeName="Primary" />
		<DimensionUsage name="Pledge Secondary Sector"	source="AMP Sector" foreignKey="secondary_sector_id" typeName="Secondary" />
		<DimensionUsage name="Pledge Tertiary Sector"	source="AMP Sector" foreignKey="tertiary_sector_id" typeName="Tertiary" />
		
		<Dimension name="Pledge Contacts" foreignKey="entity_id">
		   <!-- Pledge Contacts - START -->
		   <Hierarchy hasAll="true" allMemberName="All Contact Title@@nr@@" primaryKey="amp_activity_id" name="Contact Title@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Title@@nr@@" type="Integer" column="amp_activity_id" nameColumn="title@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Name@@nr@@" primaryKey="amp_activity_id" name="Contact Name@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Name@@nr@@" type="Integer" column="amp_activity_id" nameColumn="name@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Address@@nr@@" primaryKey="amp_activity_id" name="Contact Address@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Address@@nr@@" type="Integer" column="amp_activity_id" nameColumn="address@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Email@@nr@@" primaryKey="amp_activity_id" name="Contact Email@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Email@@nr@@" type="Integer" column="amp_activity_id" nameColumn="email@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Ministry@@nr@@" primaryKey="amp_activity_id" name="Contact Ministry@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Ministry@@nr@@" type="Integer" column="amp_activity_id" nameColumn="ministry@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Phone@@nr@@" primaryKey="amp_activity_id" name="Contact Phone@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Phone@@nr@@" type="Integer" column="amp_activity_id" nameColumn="phone@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Fax@@nr@@" primaryKey="amp_activity_id" name="Contact Fax@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Fax@@nr@@" type="Integer" column="amp_activity_id" nameColumn="fax@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Alternate Name@@nr@@" primaryKey="amp_activity_id" name="Contact Alternate Name@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Alternate Name@@nr@@" type="Integer" column="amp_activity_id" nameColumn="alternate_name@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Alternate Email@@nr@@" primaryKey="amp_activity_id" name="Contact Alternate Email@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Alternate Email@@nr@@" type="Integer" column="amp_activity_id" nameColumn="alternate_email@@nr@@" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Contact Alternate Phone@@nr@@" primaryKey="amp_activity_id" name="Contact Alternate Phone@@nr@@">
				<Table name="mondrian_activity_contacts" />
				<Level name="Contact Alternate Phone@@nr@@" type="Integer" column="amp_activity_id" nameColumn="alternate_phone@@nr@@" />
			</Hierarchy>
		<!-- Pledge Contacts - END -->
		</Dimension>
		
		<DimensionUsage name="Dates" source="AMP Date" foreignKey="display_date_code" />
		
		<Dimension name="Flow Name">
		<!-- degenerate dimension; not used in filtering or other complicated ways but for displaying only, so no key column -->
			<Hierarchy hasAll="true">
				<Level name="Flow Name" column="flow_name" />
			</Hierarchy>
		</Dimension>

		<Dimension name="Pledges Detail Dates" foreignKey="entity_internal_id">
			<Hierarchy hasAll="true" allMemberName="All Pledges Detail Start Date" primaryKey="pledge_detail_id" name="Pledges Detail Start Date">
				<View alias='v_pledges_detail_start_date'>
					<SQL dialect="generic">
						<!-- also keeping empty result for non-pledge transaction for the proper cross joins -->
						<![CDATA[
						@@transaction_start_date@@
						]]>
					</SQL>
				</View>
				<Level name="Pledges Detail Start Date" column="pledge_detail_id" nameColumn="transaction_start_date" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Pledges Detail End Date" primaryKey="pledge_detail_id" name="Pledges Detail End Date">
				<View alias='v_pledges_detail_end_date'>
					<SQL dialect="generic">
						<![CDATA[
						@@transaction_end_date@@
						]]>
					</SQL>
				</View>
				<Level name="Pledges Detail End Date" column="pledge_detail_id" nameColumn="transaction_end_date" />
			</Hierarchy>
			<Hierarchy hasAll="true" allMemberName="All Pledges Detail Date Range" primaryKey="pledge_detail_id" name="Pledges Detail Date Range">
			<View alias='v_pledges_detail_date_range'>
					<SQL dialect="generic">
						<![CDATA[
						@@transaction_range@@
						]]>
					</SQL>
				</View>
				<Level name="Pledges Detail Date Range" column="pledge_detail_id" nameColumn="transaction_range" />
			</Hierarchy>
		</Dimension>
		
		<Measure name="@@trivial_measure@@" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE 
						WHEN @@non_ac_pledges_excluder@@ (@@mondrian_fact_table@@.transaction_type=@@trivial_measure_transaction_type@@) AND (@@mondrian_fact_table@@.adjustment_type=@@trivial_measure_adjustment_type@@) AND (src_role='DN') THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ 
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="__Actual Commitments United__" aggregator="sum"> <!-- Actual Commitments for "pledges + activities" reports -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE
						WHEN (@@mondrian_fact_table@@.entity_id &gt; 800000000) AND (@@mondrian_fact_table@@.entity_id &lt; 900000000) AND (@@mondrian_fact_table@@.transaction_type=0) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (src_role='DN')
							THEN - "@@mondrian_fact_table@@".transaction_exch_@@currency@@
							
						WHEN (@@mondrian_fact_table@@.entity_id &gt; 800000000) AND (@@mondrian_fact_table@@.entity_id &lt; 900000000) AND ("@@mondrian_fact_table@@".transaction_type=7)
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						 						 
						WHEN (@@mondrian_fact_table@@.entity_id &lt; 800000000) AND (@@mondrian_fact_table@@.transaction_type=0) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (src_role='DN')
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
							
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="__Actual Commitments Usual__" aggregator="sum"> <!-- Actual Commitments for either pledge reports or activities reports -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE
						WHEN (@@mondrian_fact_table@@.transaction_type=0) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (src_role='DN')
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Real Commitments" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE
						WHEN (@@mondrian_fact_table@@.transaction_type = 200) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (flow_name &lt;&gt; 'Undefined')
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Real Disbursements" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE
						WHEN (@@mondrian_fact_table@@.transaction_type = 201) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (flow_name &lt;&gt; 'Undefined')
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>		
		
		<Measure name="Real MTEFs" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					CASE
						WHEN (@@mondrian_fact_table@@.transaction_type = 203) AND (flow_name &lt;&gt; 'Undefined')
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END
				</SQL>
			</MeasureExpression>
		</Measure>		
		
		<Measure name="Planned Disbursements - Capital" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN @@mondrian_fact_table@@.transaction_type=1 AND @@mondrian_fact_table@@.adjustment_type=@@planned@@ AND src_role='DN' AND capital_spend_percent IS NOT NULL
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ * capital_spend_percent / 100.0 ELSE null END
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Planned Disbursements - Expenditure" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"> 
					CASE WHEN @@mondrian_fact_table@@.transaction_type=1 AND @@mondrian_fact_table@@.adjustment_type=@@planned@@ AND src_role='DN' AND capital_spend_percent IS NOT NULL
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ * (100 - capital_spend_percent) / 100.0 ELSE null END
				</SQL>
			</MeasureExpression>
		</Measure>
	
		<Measure name="Actual Disbursements - Capital" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"> 
					CASE WHEN @@mondrian_fact_table@@.transaction_type=1 AND @@mondrian_fact_table@@.adjustment_type=@@actual@@ AND src_role='DN' AND capital_spend_percent IS NOT NULL
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ * capital_spend_percent / 100.0 ELSE null END
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Actual Disbursements - Recurrent" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE WHEN @@mondrian_fact_table@@.transaction_type=1 AND @@mondrian_fact_table@@.adjustment_type=@@actual@@ AND src_role='DN' AND capital_spend_percent IS NOT NULL
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ * (100 - capital_spend_percent) / 100.0 ELSE null END
				</SQL>
			</MeasureExpression>
		</Measure>
			
		<Measure name="Commitment Gap" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic">
					CASE 
						WHEN @@mondrian_fact_table@@.transaction_type=0 AND @@mondrian_fact_table@@.adjustment_type=@@actual@@ AND src_role='DN'
							THEN - "@@mondrian_fact_table@@".transaction_exch_@@currency@@ 
						WHEN "@@mondrian_fact_table@@".transaction_type=7
							THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
					END					
				</SQL>
			</MeasureExpression>
		</Measure>	
				
		<Measure name="MTEF Projections" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"><![CDATA[
					CASE WHEN (@@mondrian_fact_table@@.transaction_type=3) AND (src_role='DN') AND (@@mteffilter@@)
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ ELSE null END
				]]>	
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Pipeline MTEF Projections" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"><![CDATA[
					CASE WHEN (@@mondrian_fact_table@@.transaction_type=3) AND (src_role='DN') AND (@@pipelinemteffilter@@)
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ ELSE null END
				]]>
				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Projection MTEF Projections" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"><![CDATA[
					CASE WHEN (@@mondrian_fact_table@@.transaction_type=3) AND (src_role='DN') AND (@@projectionmteffilter@@)
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ ELSE null END
				]]>
				</SQL>
			</MeasureExpression>
		</Measure>
	
		<Measure name="Pipeline MTEF Projections - Unfiltered by date" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"><![CDATA[
					CASE WHEN (@@mondrian_fact_table@@.transaction_type = 3 + @@transaction_type_gap@@) AND (src_role='DN') AND (@@pipelinemteffilternodate@@)
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ ELSE null END
				]]>
				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Projection MTEF Projections - Unfiltered by date" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic"><![CDATA[
					CASE WHEN (@@mondrian_fact_table@@.transaction_type = 3 + @@transaction_type_gap@@) AND (src_role='DN') AND (@@projectionmteffilternodate@@)
					THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@ ELSE null END
				]]>
				</SQL>
			</MeasureExpression>
		</Measure>
				
		<Measure name="Prior Actual Disbursements" aggregator="sum">
			<!-- Current Year Actual Disbursements Until Previous Month (not included) -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					<![CDATA[
					CASE 
						WHEN (@@mondrian_fact_table@@.transaction_type=1 + @@transaction_type_gap@@) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (src_role='DN')
						AND (@@mondrian_fact_table@@.date_code >=@@current_year_start@@) AND (@@mondrian_fact_table@@.date_code <=@@month_before_last_month_end@@) 
						THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END]]>
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Cumulated Disbursements" aggregator="sum">
			<!-- Prior Actual Disbursements + Last Closed Month Disbursements -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					<![CDATA[
					CASE 
						WHEN (@@mondrian_fact_table@@.transaction_type=1 + @@transaction_type_gap@@) AND (@@mondrian_fact_table@@.adjustment_type=@@actual@@) AND (src_role='DN') 
						AND (@@mondrian_fact_table@@.date_code >=@@current_year_start@@) AND (@@mondrian_fact_table@@.date_code <=@@last_month_end@@)
						THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END]]>
				</SQL>
			</MeasureExpression>
		</Measure>

		<Measure name="Selected Year Planned Disbursements" aggregator="sum">
			<!-- Selected Year Planned Disbursements = Sum Planned Disbursements of the selected year -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					<![CDATA[
					CASE 
						WHEN (@@mondrian_fact_table@@.transaction_type=1 + @@transaction_type_gap@@) AND (@@mondrian_fact_table@@.adjustment_type=@@planned@@) AND (src_role='DN') 
						AND (@@mondrian_fact_table@@.date_code >=@@selected_year_start@@) AND (@@mondrian_fact_table@@.date_code <=@@selected_year_end@@)
						THEN "@@mondrian_fact_table@@".transaction_exch_@@currency@@
						ELSE null
					END]]>
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Cumulative Commitment" aggregator="sum">
			<!-- actual commitment affected by hierarchy & filters percentage but not affected by dates filters -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					<!-- content is filled in at runtime based on Actual Commitment value -->
					0
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<Measure name="Cumulative Disbursement" aggregator="sum">
			<!-- actual disbursement affected by hierarchy & filters percentage but not affected by dates filters -->
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					<!-- content is filled in at runtime based on Actual Disbursment value -->
					0
				</SQL>
			</MeasureExpression>
		</Measure>
				
		<Measure name="Always Present" aggregator="sum">
			<MeasureExpression>
				<SQL dialect="generic" aggregator="sum">
					0
				</SQL>
			</MeasureExpression>
		</Measure>
		
		<!-- For SSC specific calculated members please include SSC in the name 
		or define a special attr/tag to exclude them for AMP without SSC config (see AmpMondrianSchemaProcessor.removeSSCComputedMembers) 
		 -->
		<CalculatedMember name="Cumulated SSC Commitments" dimension="Measures">
		 	<Formula>
				[Measures].[Bilateral SSC Commitments] + [Measures].[Triangular SSC Commitments]
			</Formula>
		</CalculatedMember>
		
		<CalculatedMember name="Undisbursed Balance" dimension="Measures">
		 	<Formula>
				[Measures].[Actual Commitments] - [Measures].[Actual Disbursements]
			</Formula>
			<!-- some strange exception happens at last conversion call that implies some 
				formats conversion for negative values, 
				thus we need to define it explicitly,
				but it is not used anyway in Saiku display
				-->
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>			
		</CalculatedMember>

		<CalculatedMember name="Total Grand Commitments" dimension="Measures" visible="false">
		 	<Formula>
				Cast([Activity Total Amounts.Total Grand Actual Commitments].[Total Grand Actual Commitments].CurrentMember.name as Numeric)
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>			
		</CalculatedMember>
		
		<CalculatedMember name="Percentage of Total Commitments" dimension="Measures">
		 	<Formula>
				IIf(Measures.[Total Grand Commitments]=0, null, [Measures].[Actual Commitments] / Measures.[Total Grand Commitments] * 100)
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>			
		</CalculatedMember>

		<CalculatedMember name="Total Grand Disbursements" dimension="Measures" visible="false">
		 	<Formula>
				Cast([Activity Total Amounts.Total Grand Actual Disbursements].[Total Grand Actual Disbursements].CurrentMember.name as Numeric)
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>			
		</CalculatedMember>
 
		<CalculatedMember name="Percentage Of Total Disbursements" dimension="Measures">
		 	<Formula>
				IIf(Measures.[Total Grand Disbursements]=0, null, [Measures].[Actual Disbursements] / Measures.[Total Grand Disbursements] * 100)
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Total Filtered Actual Disbursements" dimension="Measures" visible="false">
			<Formula>
				SUM (NonEmptyCrossJoin([Dates.Year].[All Periods], {Measures.[Actual Disbursements]}))
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Total Filtered Planned Disbursements" dimension="Measures" visible="false">
			<Formula>
				SUM (NonEmptyCrossJoin([Dates.Year].[All Periods], {Measures.[Planned Disbursements]}))
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Execution Rate" dimension="Measures">
		 	<Formula>
				IIf((Measures.[Total Filtered Planned Disbursements]=0) 
				OR IsEmpty(Measures.[Total Filtered Planned Disbursements])
				OR IsEmpty([Measures].[Actual Disbursements]),
				null, 
				[Measures].[Actual Disbursements] / Measures.[Total Filtered Planned Disbursements] * 100)
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Proposed Project Amount" dimension="Measures" visible="false">
			<Formula>
				 IIf(IsEmpty([Activity Currency Amounts.Proposed Project Amount].[Proposed Project Amount].CurrentMember.name)
				 OR (Cast([Activity Currency Amounts.Proposed Project Amount].[Proposed Project Amount].CurrentMember.name as Numeric) &lt;= @@undefined_amount@@),
				 null,
				 Cast([Activity Currency Amounts.Proposed Project Amount].[Proposed Project Amount].CurrentMember.name as Numeric))
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Uncommitted Balance" dimension="Measures">
		 	<Formula>
		 		IIf(IsEmpty(Measures.[Proposed Project Amount]),
		 		null,
		 		[Measures].[Proposed Project Amount] - [Measures].[Actual Commitments]) 
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Total Cumulative Commitment" dimension="Measures" visible="false">
			<Formula>
				SUM (NonEmptyCrossJoin([Dates.Year].[All Periods], {Measures.[Cumulative Commitment]}))
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Cumulative Execution Rate" dimension="Measures">
			<!-- (Cumulative Disbursement / Cumulative Commitment) * 100 -->
		 	<Formula>
		 		IIf((IsEmpty(Measures.[Total Cumulative Commitment]) OR IsEmpty(Measures.[Cumulative Disbursement])
		 		OR (Measures.[Total Cumulative Commitment]=0)),
		 		null,
		 		[Measures].[Cumulative Disbursement] / [Measures].[Total Cumulative Commitment] * 100) 
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Undisbursed Cumulative Balance" dimension="Measures">
			<!-- Cumulative Commitment - Cumulative Disbursement -->
		 	<Formula>
		 		[Measures].[Cumulative Commitment] - [Measures].[Cumulative Disbursement] 
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
		
		<CalculatedMember name="Uncommitted Cumulative Balance" dimension="Measures">
			<!-- Proposed project cost - Cumulative Commitments -->
		 	<Formula>
		 		IIf(IsEmpty(Measures.[Proposed Project Amount]),
		 		null,
		 		[Measures].[Proposed Project Amount] - [Measures].[Cumulative Commitment])
			</Formula>
			<CalculatedMemberProperty name="FORMAT_STRING" value="#,##0.00"/>
		</CalculatedMember>
				
	</Cube>
 </Schema>
