"use strict";(self.webpackChunkuser_manager=self.webpackChunkuser_manager||[]).push([[116],{8587:(e,a,r)=>{r.r(a),r.d(a,{mount:()=>ne});var n=r(9994),t=r.n(n),i=r(6179),l=r(8430),o=r(1200);let s=function(e){return e.BROWSER="browser",e.MEMORY="memory",e}({});var c=r(5152);const d=e=>{if(null===e)return"No error";if("string"===typeof e)return e;const a=e;if(a){const e=Object.keys(a.error)[0],r=a.error[e][0];return r||"An error occurred."}},m="userProfile",u=(0,c.createAsyncThunk)("".concat(m,"/fetchUserProfile"),(async(e,a)=>{let{rejectWithValue:r}=a;const n=await fetch("/rest/usermanager/user/profile"),t=await n.json();return 200!==n.status?r(t):t})),h=(0,c.createSlice)({name:m,initialState:{user:null,loading:!1,error:null},reducers:{clearUser:e=>{e.user=null},updateUser:(e,a)=>{e.user=a.payload}},extraReducers:e=>{e.addCase(u.pending,(e=>{e.loading=!0})),e.addCase(u.fulfilled,((e,a)=>{e.loading=!1,e.user=a.payload})),e.addCase(u.rejected,((e,a)=>{e.loading=!1,e.error=d(a.payload)}))}}),{clearUser:f,updateUser:p}=h.actions,g=h.reducer,j=()=>(0,o.useDispatch)(),x=o.useSelector;var N=r(3836),E=r(6223);const v="Modal_input_field__zNAhT",C="Modal_modal_button__hHLPm",y="Modal_input_label__IBNfd",b="Modal_view_item__ti77R",S="Modal_text_is_invalid__WIeip",w="Modal_checkbox_wrapper__+2atB",P="Modal_form_section__LgI3a";var F=r(5392);const _=F.object().shape({firstName:F.string().required("\u26a0\ufe0f   First name is required"),lastName:F.string().required("\u26a0\ufe0f   Last name is required"),email:F.string().required("\u26a0\ufe0f   Please enter a valid email").email("\u26a0\ufe0f   Please enter a valid email"),emailConfirmation:F.string().required("\u26a0\ufe0f   Please enter a valid email").oneOf([F.ref("email")],"\u26a0\ufe0f   Emails do not match"),notificationEmailEnabled:F.boolean(),notificationEmail:F.string().email("\u26a0\ufe0f   Please enter a valid email").when("notificationEmailEnabled",{is:!0,then:e=>e.required("\u26a0\ufe0f Please enter a valid email"),otherwise:e=>e.notRequired()}),repeatNotificationEmail:F.string().email("\u26a0\ufe0f   Please enter a valid email").when("notificationEmailEnabled",{is:!0,then:e=>e.oneOf([F.ref("notificationEmail")],"\u26a0\ufe0f Please enter a valid email"),otherwise:e=>e.notRequired()})});var R=r(2577);const B="editUserProfile",M=(0,c.createAsyncThunk)("".concat(B,"/editUserProfile"),(async(e,a)=>{let{rejectWithValue:r}=a;const n=await fetch("".concat("/rest/usermanager/update/user/profile","/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await n.json();return 200!==n.status?(R.toast.error("Error updating user profile"),r(t)):(R.toast.success("User profile updated"),t)})),U=(0,c.createSlice)({name:B,initialState:{user:null,loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(M.pending,(e=>{e.loading=!0})),e.addCase(M.fulfilled,((e,a)=>{e.loading=!1,e.user=a.payload})),e.addCase(M.rejected,((e,a)=>{e.loading=!1,e.error=d(a.payload)}))}}).reducer;var I=r(9797);const k=e=>{const{open:a,onClose:r,content:n,header:t}=e;return(0,I.jsx)(N.Modal,{header:null!==t&&void 0!==t?t:"Result",content:n,open:a,onClose:r,size:"tiny",dimmer:"blurring",actions:[{key:"ok",content:"OK",positive:!0}]})},O=()=>{const e=j(),a=x((e=>e.translations.translations)),r=x((e=>e.editUserProfile)),t=(0,n.useRef)(null),i=x((e=>e.userProfile.user)),[l,o]=(0,n.useState)(!0),[s,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(!!i&&i.notificationEmailEnabled),f=(0,n.useRef)(null);if((0,n.useEffect)((()=>{(()=>{if(!r.loading&&r.error&&(m("Error updating profile."),c(!0)),!r.loading&&!r.error&&r.user){const a=i;e(p(r.user||a)),m("Profile updated successfully."),c(!0)}})()}),[r]),console.log("userProfile",i),console.log("showState",l),!i)return(0,I.jsx)("div",{});const g=()=>{const e=localStorage.getItem("PREVIOUS_URL");o(!1),e&&window.location.replace(e)},F=()=>{c(!1),g()},R={firstName:i.firstName,lastName:i.lastName,email:i.email,emailConfirmation:i.email,notificationEmail:i.notificationEmail,repeatNotificationEmail:i.notificationEmail,notificationEmailEnabled:u,id:i.id,address:i.address,countryIso:i.countryIso,country:i.country,languageCode:i.languageCode,organizationId:i.organizationId,organizationName:i.organizationName,organizationTypeId:i.organizationTypeId,organizationGroupId:i.organizationGroupId};return(0,I.jsx)(I.Fragment,{children:i&&(0,I.jsx)("div",{children:(0,I.jsxs)(N.Modal,{onClose:()=>g(),onOpen:()=>o(!0),open:l,ref:t,closeIcon:!0,centered:!0,dimmer:"blurring",children:[(0,I.jsx)(N.Modal.Header,{children:"Edit Profile"}),(0,I.jsx)(E.Formik,{validationSchema:_,initialValues:R,innerRef:f,onSubmit:a=>(a=>{e(M(a))})(a),children:e=>{var r;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(N.Modal.Description,{children:(0,I.jsx)(N.Form,{noValidate:!0,onSubmit:e.handleSubmit,children:(0,I.jsxs)(N.Modal.Content,{image:!0,children:[(0,I.jsxs)("div",{className:P,children:[(0,I.jsxs)(N.Form.Group,{children:[(0,I.jsxs)(N.Form.Field,{className:b,required:!0,children:[(0,I.jsx)("label",{htmlFor:"fistName",className:y,children:a["amp.user-manager:first-name"]}),(0,I.jsx)("input",{type:"text",placeholder:a["amp.user-manager:enter-first-name"],name:"firstName",id:"firstName",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.firstName&&e.touched.firstName&&S),defaultValue:e.values.firstName}),e.errors.firstName&&e.touched.firstName&&(0,I.jsx)("h6",{children:e.errors.firstName})]}),(0,I.jsxs)(N.Form.Field,{className:b,required:!0,children:[(0,I.jsx)("label",{htmlFor:"lastName",className:y,children:a["amp.user-manager:last-name"]}),(0,I.jsx)("input",{type:"text",placeholder:a["amp.user-manager:enter-last-name"],name:"lastName",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.lastName&&e.touched.lastName&&S),defaultValue:e.values.lastName}),e.errors.lastName&&e.touched.lastName&&(0,I.jsx)("h6",{children:e.errors.lastName})]})]}),(0,I.jsxs)(N.Form.Group,{children:[(0,I.jsxs)(N.Form.Field,{className:b,required:!0,children:[(0,I.jsx)("label",{htmlFor:"email",className:y,children:a["amp.user-manager:email"]}),(0,I.jsx)("input",{type:"email",placeholder:"john@doe.com",name:"email",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.email&&e.touched.email&&S),defaultValue:e.values.email}),e.errors.email&&e.touched.email&&(0,I.jsx)("h6",{children:e.errors.email})]}),(0,I.jsxs)(N.Form.Field,{className:b,required:!0,children:[(0,I.jsx)("label",{htmlFor:"emailConfirmation",className:y,children:a["amp.user-manager:repeat-email"]}),(0,I.jsx)("input",{type:"email",placeholder:"john@doe.com",name:"emailConfirmation",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.emailConfirmation&&e.touched.emailConfirmation&&S),defaultValue:e.values.email}),e.errors.emailConfirmation&&e.touched.emailConfirmation&&(0,I.jsx)("h6",{children:e.errors.emailConfirmation})]})]}),(0,I.jsx)("br",{}),(0,I.jsx)("br",{})]}),(0,I.jsxs)("div",{className:P,children:[(0,I.jsx)(N.Form.Group,{className:w,children:(0,I.jsx)(N.Form.Field,{control:N.Checkbox,label:a["amp.user-manager:receive-notifications"],defaultChecked:null!==(r=e.values.notificationEmailEnabled)&&void 0!==r&&r,name:"notificationEmailEnabled",id:"notificationEmailEnabled",onChange:e.handleChange,onBlur:e.handleBlur})}),e.values.notificationEmailEnabled&&(0,I.jsxs)(N.Form.Group,{children:[(0,I.jsxs)(N.Form.Field,{className:b,children:[(0,I.jsx)("label",{htmlFor:"notificationEmail",className:y,children:a["amp.user-manager:alternative-email"]}),(0,I.jsx)("input",{type:"email",placeholder:"john@doe.com",name:"notificationEmail",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.notificationEmail&&e.touched.notificationEmail&&S),defaultValue:e.values.notificationEmail}),e.errors.notificationEmail&&e.touched.notificationEmail&&(0,I.jsx)("h6",{children:e.errors.notificationEmail})]}),(0,I.jsxs)(N.Form.Field,{className:b,children:[(0,I.jsx)("label",{className:y,children:a["amp.user-manager:repeat-alternative-email"]}),(0,I.jsx)("input",{type:"email",placeholder:"john@doe.com",name:"repeatNotificationEmail",onChange:e.handleChange,onBlur:e.handleBlur,className:"".concat(v," ").concat(e.errors.repeatNotificationEmail&&e.touched.repeatNotificationEmail&&S),defaultValue:e.values.notificationEmail}),e.errors.repeatNotificationEmail&&e.touched.repeatNotificationEmail&&(0,I.jsx)("h6",{children:e.errors.repeatNotificationEmail})]})]})]})]})})}),(0,I.jsxs)(N.Modal.Actions,{children:[(0,I.jsx)(N.Button,{negative:!0,onClick:g,className:C,children:a["amp.user-manager:cancel"]}),(0,I.jsx)(N.Button,{type:"submit",positive:!0,className:C,onClick:e.handleSubmit,children:a["amp.user-manager:save"]})]}),(0,I.jsx)(k,{onClose:F,content:d,open:s})]})}})]})})})},T="POST",q="GET",L="AMP_";function V(e){return new Promise((a=>{fetch("/rest/translations/label-translations",function(e,a){const r={method:e?T:q,headers:a||{"Content-Type":"application/json",Accept:"application/json","ws-prefix":L}};return e&&(r.body=JSON.stringify(e)),r}(e,null)).then((e=>{const r=e.headers.get("content-type");if(r&&-1!==r.indexOf("application/json"))return e.json().then((e=>{if(e.error)throw new Error(e.error);return a(e)}))}))}))}const A=JSON.parse('{"amp.user-manager:users":"Users","amp.user-manager:edit-profile":"Edit Profile","amp.user-manager:first-name":"First Name","amp.user-manager:enter-first-name":"Enter First Name","amp.user-manager:last-name":"Last Name","amp.user-manager:enter-last-name":"Enter Last Name","amp.user-manager:email":"Email","amp.user-manager:repeat-email":"Repeat Email","amp.user-manager:receive-notifications":"Use a different email for email notifications","amp.user-manager:alternative-email":"Alternative Email","amp.user-manager:repeat-alternative-email":"Repeat Alternate Email","amp.user-manager:cancel":"Cancel","amp.user-manager:save":"Save"}'),z={translations:A,loading:!1,error:null},G=(0,c.createAsyncThunk)("translations/fetchTranslations",(async(e,a)=>{let{rejectWithValue:r}=a;const n=await V(e);return n||r(n)})),W=(0,c.createSlice)({name:"translations",initialState:z,reducers:{},extraReducers:e=>{e.addCase(G.pending,(e=>{e.loading=!0})),e.addCase(G.fulfilled,((e,a)=>{e.loading=!1,e.translations=a.payload})),e.addCase(G.rejected,((e,a)=>{e.loading=!1,e.error=d(a.payload)}))}}).reducer,J=()=>{const e=j(),a=(0,l.useNavigate)(),r=x((e=>e.userProfile.loading)),t=x((e=>e.translations.loading));return(0,n.useEffect)((()=>{window.addEventListener("openUserModal",(e=>{a("/edit-profile")}))}),[]),(0,n.useEffect)((()=>{e(G(A)),e(u())}),[]),(0,I.jsx)(I.Fragment,{children:r||t?(0,I.jsx)("div",{children:"Loading..."}):(0,I.jsx)("div",{className:"App",children:(0,I.jsx)(O,{})})})};const D=function(){return(0,I.jsx)(J,{})},H="/reampv2-app",$=e=>{let{children:a}=e;const r=(0,l.useLocation)(),t=(0,l.useNavigate)();return(0,n.useEffect)((()=>{function e(e){let a=e.detail;a.includes("user-manager")&&(a=a.replace("user-manager","")),r.pathname!==a&&(0,l.matchRoutes)(K,{pathname:a})&&t(a)}return window.addEventListener("[container] navigated",e),()=>{window.removeEventListener("[container] navigated",e)}}),[r]),(0,n.useEffect)((()=>{const e=new CustomEvent("[UserManager] navigated",{detail:r.pathname});window.dispatchEvent(e)}),[r]),(0,n.useEffect)((()=>{if(r.pathname.startsWith(H)){const e=new CustomEvent("[reampv2] navigated",{detail:r.pathname.replace(H,"")});window.dispatchEvent(e)}}),[r]),a},K=[{path:"/",element:(0,I.jsx)($,{children:(0,I.jsx)(l.Outlet,{})}),children:[{index:!0,element:(0,I.jsx)("div",{children:(0,I.jsx)(D,{})})},{path:"edit-profile",element:(0,I.jsx)(D,{})}]},{path:"*",element:(0,I.jsx)("div",{})}],Y={userProfile:g,editUserProfile:U,translations:W},Q={...(()=>{const e=localStorage.getItem("state");if(null!==e)return JSON.parse(e)})()},X=(0,c.configureStore)({reducer:(0,c.combineReducers)(Y),preloadedState:Q}),Z=e=>{const{routingStrategy:a,initialPathName:r}=e,n=(e=>{let{routingStrategy:a,initialPathName:r}=e;if(a===s.BROWSER)return(0,l.createBrowserRouter)(K);const n=[r];return(0,l.createMemoryRouter)(K,{initialEntries:n})})({routingStrategy:a,initialPathName:r});return(0,I.jsx)(o.Provider,{store:X,children:(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(l.RouterProvider,{router:n})})})},ee=e=>{e&&e instanceof Function&&r.e(539).then(r.t.bind(r,1539,23)).then((a=>{let{getCLS:r,getFID:n,getFCP:t,getLCP:i,getTTFB:l}=a;r(e),n(e),t(e),i(e),l(e)}))};r(7160),r(6098);const ae=r(5174);function re(e){let{routingStrategy:a,initialPathName:r}=e;return(0,I.jsx)(t().StrictMode,{children:(0,I.jsx)(Z,{routingStrategy:a,initialPathName:r})})}const ne=e=>{let{mountPoint:a,routingStrategy:r,initialPathName:n="/",standalone:t=!0}=e;if(a&&i.createRoot(a).render((0,I.jsx)(re,{routingStrategy:r,initialPathName:n})),t){function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href;e=e.replace(/[[\]]/g,"\\$&");const r=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(a);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}l("embedded")||new ae.layout({})}ee()}}}]);
//# sourceMappingURL=116.bundle.js.map