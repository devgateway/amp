package org.dgfoundation.amp.ar.amp212;

import java.util.Arrays;
import java.util.List;

import org.dgfoundation.amp.ar.ColumnConstants;
import org.dgfoundation.amp.ar.MeasureConstants;
import org.dgfoundation.amp.mondrian.ReportAreaForTests;
import org.dgfoundation.amp.mondrian.ReportingTestCase;
import org.dgfoundation.amp.newreports.AreaOwner;
import org.dgfoundation.amp.newreports.GroupingCriteria;
import org.dgfoundation.amp.nireports.output.NiReportExecutor;
import org.dgfoundation.amp.nireports.testcases.NiReportModel;
import org.junit.Test;

/**
 * 
 * testcases for the fetching states of AMP + the AMP schema
 * 
 * @author Constantin Dolghier
 *
 */
public class FundingFlowsTests extends ReportingTestCase {

    final List<String> flowsActs = Arrays.asList(
        "activity with directed MTEFs",
        "Activity with both MTEFs and Act.Comms",
        "mtef activity 1",
        "mtef activity 2",
        "Pure MTEF Project",
        "activity with MTEFs",
        "activity with many MTEFs",
        "Test MTEF directed",
        "activity with pipeline MTEFs and act. disb",
        "Eth Water",
        "Activity with Zones",
        "TAC_activity_2"
    );
    
    @Override
    protected NiReportExecutor getNiExecutor(List<String> activityNames) {
        return getDbExecutor(activityNames);
    }
    
    @Test
    public void testComplexHeaderWithSplitColumnsAndMeasures() {
        NiReportModel cor = new NiReportModel("AMP-15337-complex-header")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 31))",
                    "(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Real MTEF 2011: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 1, colSpan: 2));(Real MTEF 2012: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 3, colSpan: 2));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 5, colSpan: 15));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 20, colSpan: 11))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 5, colSpan: 3));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 8, colSpan: 2));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 10, colSpan: 6));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 16, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 18, colSpan: 2))",
                    "(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 5, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 6, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 7, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 8, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 9, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 10, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 11, colSpan: 4));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 16, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 17, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 19, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 20, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 21, colSpan: 5));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 26, colSpan: 1));(Real MTEF: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 27, colSpan: 4))",
                    "(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 1, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(EXEC-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 11, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 12, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 13, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 14, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 21, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 22, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 23, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 24, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 25, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 27, colSpan: 1));(EXEC-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 28, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 29, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 30, colSpan: 1))"))
                .withWarnings(Arrays.asList(
                    "-1: [entityId: -1, message: measure \"Real MTEFs\" not supported in NiReports]"))
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Funding-2013-Actual Disbursements", "580 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "1 011 456", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Actual Disbursements", "1 331 990", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Actual Disbursements", "453 213", "Funding-2011-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                    new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Actual Disbursements", "143 777", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Actual Disbursements", "143 777"),
                    new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project"),
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Actual Disbursements", "545 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Actual Disbursements", "545 000"),
                    new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1"),
                    new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2"),
                    new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                    new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "Funding-2015-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000"),
                    new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2015-Actual Commitments", "123 456", "Totals-Actual Commitments", "123 456", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500"),
                    new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000"),
                    new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000")      ));
        
        runNiTestCase(cor, spec("AMP-15337-complex-header"), flowsActs);
    }
    
    @Test
    public void testComplexHeaderWithSplitMeasures() {
        NiReportModel cor = new NiReportModel("AMP-15337-crazy-header")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 23))",
                    "(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 1, colSpan: 15));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 16, colSpan: 7))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 1, colSpan: 3));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 4, colSpan: 2));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 6, colSpan: 6));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 12, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 14, colSpan: 2))",
                    "(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 1, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 3, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 4, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 5, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 6, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 7, colSpan: 4));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 13, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 14, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 16, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 17, colSpan: 5));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 22, colSpan: 1))",
                    "(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 17, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 18, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 19, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 20, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 21, colSpan: 1))"))
                .withWarnings(Arrays.asList(
                    "-1: [entityId: -1, message: measure \"Real MTEFs\" not supported in NiReports]"))
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "Funding-2010-Actual Commitments", "0", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Funding-2013-Actual Disbursements", "580 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "1 011 456", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Actual Disbursements", "1 331 990")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Actual Disbursements", "453 213", "Funding-2011-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                    new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Actual Disbursements", "143 777", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Actual Disbursements", "143 777"),
                    new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project"),
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Actual Disbursements", "545 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Actual Disbursements", "545 000"),
                    new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1"),
                    new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2"),
                    new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                    new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "Funding-2015-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000"),
                    new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Funding-2015-Actual Commitments", "123 456", "Totals-Actual Commitments", "123 456"),
                    new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000"),
                    new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000")      ));
        
        runNiTestCase(cor, spec("AMP-15337-crazy-header"), flowsActs);
    }

    @Test
    public void testComplexHeaderWithSplitMeasuresOnly() {
        NiReportModel cor = new NiReportModel("AMP-15337-real-disbursements")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 11))",
                    "(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 1, colSpan: 5));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 6, colSpan: 5))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 1, colSpan: 1));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 2, colSpan: 4))",
                    "(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 1, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 4));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 6, colSpan: 5))",
                    "(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 1, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1))"))
                .withWarnings(Arrays.asList())
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2"),
                    new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333"),
                    new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project"),
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000"),
                    new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1"),
                    new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2"),
                    new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones"),
                    new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms"),
                    new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs"),
                    new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb"),
                    new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs")      ));
        
        runNiTestCase(cor, spec("AMP-15337-real-disbursements"), flowsActs);
    }
    
    @Test
    public void testRealDisbursementsByDonor() {
        NiReportModel cor = new NiReportModel("AMP-15337-real-disbursements-by-donor")
        .withHeaders(Arrays.asList(
                "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 6))",
                "(Donor Agency: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 2, colSpan: 2));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 4, colSpan: 2))",
                "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 2, colSpan: 1));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 3, colSpan: 1))",
                "(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 3, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 4, colSpan: 2))",
                "(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1))"))
            .withWarnings(Arrays.asList())
            .withBody(      new ReportAreaForTests(null)
              .withContents("Donor Agency", "", "Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222")
              .withChildren(
                new ReportAreaForTests(new AreaOwner("Donor Agency", "Finland")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "0", "Funding-2013-Real Disbursements-DN-EXEC", "20 000", "Totals-Real Disbursements-DN-EXEC", "20 000", "Totals-Real Disbursements-DN-IMPL", "0", "Donor Agency", "Finland")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "20 000", "Totals-Real Disbursements-DN-EXEC", "20 000")        ),
                new ReportAreaForTests(new AreaOwner("Donor Agency", "Ministry of Economy")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-DN-EXEC", "0", "Totals-Real Disbursements-DN-EXEC", "0", "Totals-Real Disbursements-DN-IMPL", "77 222", "Donor Agency", "Ministry of Economy")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-DN-IMPL", "77 222")        ),
                new ReportAreaForTests(new AreaOwner("Donor Agency", "Norway")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "0", "Funding-2013-Real Disbursements-DN-EXEC", "110 000", "Totals-Real Disbursements-DN-EXEC", "110 000", "Totals-Real Disbursements-DN-IMPL", "0", "Donor Agency", "Norway")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "110 000", "Totals-Real Disbursements-DN-EXEC", "110 000")        ),
                new ReportAreaForTests(new AreaOwner("Donor Agency", "USAID")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "0", "Funding-2013-Real Disbursements-DN-EXEC", "415 000", "Totals-Real Disbursements-DN-EXEC", "415 000", "Totals-Real Disbursements-DN-IMPL", "0", "Donor Agency", "USAID")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "415 000", "Totals-Real Disbursements-DN-EXEC", "415 000")        )      ));
        
        runNiTestCase(cor, spec("AMP-15337-real-disbursements-by-donor"), flowsActs);
    }
    
    @Test
    public void testRealDisbursementsByExecuting() {
        NiReportModel cor = new NiReportModel("AMP-15337-real-disbursements-by-executing")
        .withHeaders(Arrays.asList(
                "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 8))",
                "(Executing Agency: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 2, colSpan: 3));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 5, colSpan: 3))",
                "(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 2, colSpan: 3))",
                "(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 3));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 5, colSpan: 3))",
                "(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1))"))
            .withWarnings(Arrays.asList())
            .withBody(      new ReportAreaForTests(null)
              .withContents("Executing Agency", "", "Project Title", "", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333")
              .withChildren(
                new ReportAreaForTests(new AreaOwner("Executing Agency", "UNDP")).withContents("Project Title", "", "Funding-2013-Real Disbursements-DN-EXEC", "300 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "80 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "0", "Totals-Real Disbursements-DN-EXEC", "300 000", "Totals-Real Disbursements-EXEC-IMPL", "80 000", "Totals-Real Disbursements-IMPL-EXEC", "0", "Executing Agency", "UNDP")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "300 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "80 000", "Totals-Real Disbursements-DN-EXEC", "300 000", "Totals-Real Disbursements-EXEC-IMPL", "80 000")        ),
                new ReportAreaForTests(new AreaOwner("Executing Agency", "Water Foundation")).withContents("Project Title", "", "Funding-2013-Real Disbursements-DN-EXEC", "0", "Funding-2013-Real Disbursements-EXEC-IMPL", "0", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-EXEC", "0", "Totals-Real Disbursements-EXEC-IMPL", "0", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Executing Agency", "Water Foundation")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Test MTEF directed", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-IMPL-EXEC", "44 333")        ),
                new ReportAreaForTests(new AreaOwner("Executing Agency", "World Bank")).withContents("Project Title", "", "Funding-2013-Real Disbursements-DN-EXEC", "245 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "20 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "0", "Totals-Real Disbursements-DN-EXEC", "245 000", "Totals-Real Disbursements-EXEC-IMPL", "20 000", "Totals-Real Disbursements-IMPL-EXEC", "0", "Executing Agency", "World Bank")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "245 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "20 000", "Totals-Real Disbursements-DN-EXEC", "245 000", "Totals-Real Disbursements-EXEC-IMPL", "20 000")        )      ));
        
        runNiTestCase(cor, spec("AMP-15337-real-disbursements-by-executing"), flowsActs);
    }
    
    @Test
    public void testRealDisbursementsByImplementing() {
        NiReportModel cor = new NiReportModel("AMP-15337-real-disbursements-by-implementing")
        .withHeaders(Arrays.asList(
                "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 10))",
                "(Implementing Agency: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 2, colSpan: 4));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 6, colSpan: 4))",
                "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 2, colSpan: 1));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 3, colSpan: 3))",
                "(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 3, colSpan: 3));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 6, colSpan: 4))",
                "(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1))"))
            .withWarnings(Arrays.asList())
            .withBody(      new ReportAreaForTests(null)
              .withContents("Implementing Agency", "", "Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333")
              .withChildren(
                new ReportAreaForTests(new AreaOwner("Implementing Agency", "Ministry of Economy")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "0", "Funding-2013-Real Disbursements-EXEC-IMPL", "50 000", "Funding-2013-Real Disbursements-IMPL-BENF", "5 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "0", "Totals-Real Disbursements-DN-IMPL", "0", "Totals-Real Disbursements-EXEC-IMPL", "50 000", "Totals-Real Disbursements-IMPL-BENF", "5 000", "Totals-Real Disbursements-IMPL-EXEC", "0", "Implementing Agency", "Ministry of Economy")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-EXEC-IMPL", "50 000", "Funding-2013-Real Disbursements-IMPL-BENF", "5 000", "Totals-Real Disbursements-EXEC-IMPL", "50 000", "Totals-Real Disbursements-IMPL-BENF", "5 000")        ),
                new ReportAreaForTests(new AreaOwner("Implementing Agency", "Ministry of Finance")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "0", "Funding-2013-Real Disbursements-EXEC-IMPL", "50 000", "Funding-2013-Real Disbursements-IMPL-BENF", "10 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "0", "Totals-Real Disbursements-DN-IMPL", "0", "Totals-Real Disbursements-EXEC-IMPL", "50 000", "Totals-Real Disbursements-IMPL-BENF", "10 000", "Totals-Real Disbursements-IMPL-EXEC", "0", "Implementing Agency", "Ministry of Finance")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-EXEC-IMPL", "50 000", "Funding-2013-Real Disbursements-IMPL-BENF", "10 000", "Totals-Real Disbursements-EXEC-IMPL", "50 000", "Totals-Real Disbursements-IMPL-BENF", "10 000")        ),
                new ReportAreaForTests(new AreaOwner("Implementing Agency", "USAID")).withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-EXEC-IMPL", "0", "Funding-2013-Real Disbursements-IMPL-BENF", "0", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "0", "Totals-Real Disbursements-IMPL-BENF", "0", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Implementing Agency", "USAID")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333")        )      ));
        
        runNiTestCase(cor, spec("AMP-15337-real-disbursements-by-implementing"), flowsActs);
    }
    
    @Test
    public void testRealDisbursementsByPrimarySector() {
        NiReportModel cor = new NiReportModel("AMP-15337-real-disbursements-by-primary-sector")
        .withHeaders(Arrays.asList(
                "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 12))",
                "(Primary Sector: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 2, colSpan: 5));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 7, colSpan: 5))",
                "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 2, colSpan: 1));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 3, colSpan: 4))",
                "(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 1));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 3, colSpan: 4));(Real Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 7, colSpan: 5))",
                "(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(DN-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(EXEC-IMPL: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 11, colSpan: 1))"))
            .withWarnings(Arrays.asList())
            .withBody(      new ReportAreaForTests(null).withContents("Primary Sector", "", "Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333")
              .withChildren(
                new ReportAreaForTests(new AreaOwner("Primary Sector", "110 - EDUCATION"))
                .withContents("Project Title", "", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Primary Sector", "110 - EDUCATION")
                .withChildren(
                  new ReportAreaForTests(null, "Project Title", "Test MTEF directed", "Funding-2010-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333"),
                  new ReportAreaForTests(null, "Project Title", "Eth Water", "Funding-2013-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000")        )      ));
        
        runNiTestCase(cor, spec("AMP-15337-real-disbursements-by-primary-sector"), flowsActs);
    }
    
    @Test
    public void testRealMtefsMixedWithMtefs() {
        NiReportModel cor = new NiReportModel("AMP-22322-directed-mtefs")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 24))",
                    "(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(MTEF 2011: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(MTEF 2012: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 2, colSpan: 1));(Real MTEF 2011: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 3, colSpan: 2));(Real MTEF 2012: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 5, colSpan: 2));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 7, colSpan: 10));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 17, colSpan: 7))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 7, colSpan: 2));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 9, colSpan: 2));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 11, colSpan: 2));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 13, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 15, colSpan: 2))",
                    "(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 7, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 8, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 9, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 10, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 13, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 14, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 16, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 17, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(MTEF: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 19, colSpan: 1));(Real MTEF: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 20, colSpan: 4))",
                    "(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 3, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(EXEC-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 20, colSpan: 1));(EXEC-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 21, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 22, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 23, colSpan: 1))"))
                .withWarnings(Arrays.asList(
                    "-1: [entityId: -1, message: measure \"Real MTEFs\" not supported in NiReports]"))
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Actual Disbursements", "580 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "1 011 456", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Actual Disbursements", "1 331 990", "Totals-MTEF", "1 989 011", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Actual Disbursements", "453 213", "Funding-2011-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                    new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "MTEF 2011", "150 000", "MTEF 2012", "65 000", "Funding-2010-Actual Disbursements", "143 777", "Totals-Actual Disbursements", "143 777", "Totals-MTEF", "215 000"),
                    new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project", "MTEF 2011", "33 888", "Totals-MTEF", "33 888"),
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Actual Disbursements", "545 000", "Totals-Actual Disbursements", "545 000"),
                    new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1", "MTEF 2011", "789 123", "Totals-MTEF", "789 123"),
                    new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2"),
                    new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                    new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "MTEF 2011", "700 000", "MTEF 2012", "150 000", "Funding-2015-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000", "Totals-MTEF", "850 000"),
                    new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2015-Actual Commitments", "123 456", "Totals-Actual Commitments", "123 456", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500"),
                    new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000"),
                    new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "MTEF 2011", "45 000", "MTEF 2012", "56 000", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000", "Totals-MTEF", "101 000")      ));
        
        runNiTestCase(cor, spec("AMP-22322-directed-mtefs"), flowsActs);
    }

    @Test
    public void testRealMtefsMixedWithMtefsByBeneficiaryAgency() {
        NiReportModel cor = new NiReportModel("AMP-22322-directed-mtefs-by-beneficiary")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 21))",
                    "(Beneficiary Agency: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(MTEF 2011: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 2, colSpan: 1));(MTEF 2012: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 3, colSpan: 1));(Real MTEF 2011: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 4, colSpan: 1));(Real MTEF 2012: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 5, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 6, colSpan: 10));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 16, colSpan: 5))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 6, colSpan: 2));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 8, colSpan: 2));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 10, colSpan: 2));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 12, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 14, colSpan: 2))",
                    "(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 6, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 7, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 8, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 9, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 10, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 13, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 14, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 16, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 17, colSpan: 1));(MTEF: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(Real MTEF: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 19, colSpan: 2))",
                    "(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 19, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 20, colSpan: 1))"))
                .withWarnings(Arrays.asList(
                    "-1: [entityId: -1, message: measure \"Real MTEFs\" not supported in NiReports]"))
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Beneficiary Agency", "", "Project Title", "", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Actual Disbursements", "580 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "1 011 456", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Actual Disbursements", "1 331 990", "Totals-MTEF", "1 989 011", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-IMPL-BENF", "43 000")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency", "USAID")).withContents("Project Title", "", "MTEF 2011", "0", "MTEF 2012", "0", "Real MTEF 2011-EXEC-BENF", "0", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "0", "Funding-2011-Actual Commitments", "0", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "0", "Funding-2013-Actual Disbursements", "0", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "0", "Funding-2015-Actual Commitments", "108 641,28", "Funding-2015-Actual Disbursements", "0", "Totals-Actual Commitments", "108 641,28", "Totals-Actual Disbursements", "0", "Totals-MTEF", "0", "Totals-Real MTEF-EXEC-BENF", "0", "Totals-Real MTEF-IMPL-BENF", "43 000", "Beneficiary Agency", "USAID")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2015-Actual Commitments", "108 641,28", "Totals-Actual Commitments", "108 641,28", "Totals-Real MTEF-IMPL-BENF", "43 000")        ),
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency", "Water Foundation"))
                    .withContents("Project Title", "", "MTEF 2011", "0", "MTEF 2012", "0", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2012-IMPL-BENF", "0", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "0", "Funding-2011-Actual Commitments", "0", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "0", "Funding-2013-Actual Disbursements", "272 500", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "0", "Funding-2015-Actual Commitments", "14 814,72", "Funding-2015-Actual Disbursements", "0", "Totals-Actual Commitments", "14 814,72", "Totals-Actual Disbursements", "272 500", "Totals-MTEF", "0", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-IMPL-BENF", "0", "Beneficiary Agency", "Water Foundation")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Actual Disbursements", "272 500", "Totals-Actual Disbursements", "272 500"),
                      new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2011-EXEC-BENF", "50 000", "Funding-2015-Actual Commitments", "14 814,72", "Totals-Actual Commitments", "14 814,72", "Totals-Real MTEF-EXEC-BENF", "50 000")        ),
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency", "Water Org")).withContents("Project Title", "", "MTEF 2011", "0", "MTEF 2012", "0", "Real MTEF 2011-EXEC-BENF", "0", "Real MTEF 2012-IMPL-BENF", "0", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "0", "Funding-2011-Actual Commitments", "0", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "0", "Funding-2013-Actual Disbursements", "272 500", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "0", "Funding-2015-Actual Commitments", "0", "Funding-2015-Actual Disbursements", "0", "Totals-Actual Commitments", "0", "Totals-Actual Disbursements", "272 500", "Totals-MTEF", "0", "Totals-Real MTEF-EXEC-BENF", "0", "Totals-Real MTEF-IMPL-BENF", "0", "Beneficiary Agency", "Water Org")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Actual Disbursements", "272 500", "Totals-Actual Disbursements", "272 500")        ),
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency", "Beneficiary Agency: Undefined"))
                    .withContents("Project Title", "", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "Real MTEF 2011-EXEC-BENF", "0", "Real MTEF 2012-IMPL-BENF", "0", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "888 000", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 457 888", "Totals-Actual Disbursements", "786 990", "Totals-MTEF", "1 989 011", "Totals-Real MTEF-EXEC-BENF", "0", "Totals-Real MTEF-IMPL-BENF", "0", "Beneficiary Agency", "Beneficiary Agency: Undefined")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Actual Disbursements", "453 213", "Funding-2011-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                      new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "MTEF 2011", "150 000", "MTEF 2012", "65 000", "Funding-2010-Actual Disbursements", "143 777", "Totals-Actual Disbursements", "143 777", "Totals-MTEF", "215 000"),
                      new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project", "MTEF 2011", "33 888", "Totals-MTEF", "33 888"),
                      new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1", "MTEF 2011", "789 123", "Totals-MTEF", "789 123"),
                      new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                      new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "MTEF 2011", "700 000", "MTEF 2012", "150 000", "Funding-2015-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000", "Totals-MTEF", "850 000"),
                      new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000"),
                      new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "MTEF 2011", "45 000", "MTEF 2012", "56 000", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000", "Totals-MTEF", "101 000")        )      ));
        
        runNiTestCase(cor, spec("AMP-22322-directed-mtefs-by-beneficiary"), flowsActs);
    }
    
    @Test
    public void testRealMtefsMixedWithMtefsByBeneficiaryAgencyGroups() {
        NiReportModel cor = new NiReportModel("AMP-22322-directed-mtefs-by-beneficiary-agency-groups")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 22))",
                    "(Beneficiary Agency Groups: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 1, colSpan: 1));(Beneficiary Agency: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 2, colSpan: 1));(MTEF 2011: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 3, colSpan: 1));(MTEF 2012: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 4, colSpan: 1));(Real MTEF 2011: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 5, colSpan: 1));(Real MTEF 2012: (startRow: 1, rowSpan: 3, totalRowSpan: 4, colStart: 6, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 7, colSpan: 10));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 17, colSpan: 5))",
                    "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 7, colSpan: 2));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 9, colSpan: 2));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 11, colSpan: 2));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 13, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 15, colSpan: 2))",
                    "(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 7, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 8, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 9, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 10, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 13, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 14, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 16, colSpan: 1));(Actual Commitments: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 17, colSpan: 1));(Actual Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(MTEF: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 19, colSpan: 1));(Real MTEF: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 20, colSpan: 2))",
                    "(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 6, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 20, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 21, colSpan: 1))"))
                .withWarnings(Arrays.asList(
                    "-1: [entityId: -1, message: measure \"Real MTEFs\" not supported in NiReports]"))
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Beneficiary Agency Groups", "", "Project Title", "", "Beneficiary Agency", "", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Actual Disbursements", "580 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "1 011 456", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Actual Disbursements", "1 331 990", "Totals-MTEF", "1 989 011", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-IMPL-BENF", "43 000")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency Groups", "American"))
                    .withContents("Project Title", "", "Beneficiary Agency", "", "MTEF 2011", "0", "MTEF 2012", "0", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "0", "Funding-2011-Actual Commitments", "0", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "0", "Funding-2013-Actual Disbursements", "545 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "0", "Funding-2015-Actual Commitments", "123 456", "Funding-2015-Actual Disbursements", "0", "Totals-Actual Commitments", "123 456", "Totals-Actual Disbursements", "545 000", "Totals-MTEF", "0", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Beneficiary Agency Groups", "American")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Beneficiary Agency", "Water Foundation, Water Org", "Funding-2013-Actual Disbursements", "545 000", "Totals-Actual Disbursements", "545 000"),
                      new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Beneficiary Agency", "USAID, Water Foundation", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Funding-2015-Actual Commitments", "123 456", "Totals-Actual Commitments", "123 456", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-IMPL-BENF", "43 000")        ),
                    new ReportAreaForTests(new AreaOwner("Beneficiary Agency Groups", "Beneficiary Agency Groups: Undefined"))
                    .withContents("Project Title", "", "Beneficiary Agency", "", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "Real MTEF 2011-EXEC-BENF", "0", "Real MTEF 2012-IMPL-BENF", "0", "Funding-2010-Actual Commitments", "0", "Funding-2010-Actual Disbursements", "596 990", "Funding-2011-Actual Commitments", "999 888", "Funding-2011-Actual Disbursements", "0", "Funding-2013-Actual Commitments", "570 000", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Commitments", "0", "Funding-2014-Actual Disbursements", "75 000", "Funding-2015-Actual Commitments", "888 000", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 457 888", "Totals-Actual Disbursements", "786 990", "Totals-MTEF", "1 989 011", "Totals-Real MTEF-EXEC-BENF", "0", "Totals-Real MTEF-IMPL-BENF", "0", "Beneficiary Agency Groups", "Beneficiary Agency Groups: Undefined")
                    .withChildren(
                      new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Actual Disbursements", "453 213", "Funding-2011-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                      new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "MTEF 2011", "150 000", "MTEF 2012", "65 000", "Funding-2010-Actual Disbursements", "143 777", "Totals-Actual Disbursements", "143 777", "Totals-MTEF", "215 000"),
                      new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project", "MTEF 2011", "33 888", "Totals-MTEF", "33 888"),
                      new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1", "MTEF 2011", "789 123", "Totals-MTEF", "789 123"),
                      new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                      new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "MTEF 2011", "700 000", "MTEF 2012", "150 000", "Funding-2015-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000", "Totals-MTEF", "850 000"),
                      new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "Funding-2013-Actual Disbursements", "35 000", "Funding-2014-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000"),
                      new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "MTEF 2011", "45 000", "MTEF 2012", "56 000", "Funding-2015-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000", "Totals-MTEF", "101 000")        )      ));
        
        runNiTestCase(cor, spec("AMP-22322-directed-mtefs-by-beneficiary-agency-groups"), flowsActs);
    }
    
    @Test
    public void testAllFlowsQuarterly() {
        NiReportModel cor = new NiReportModel("AMP-22322-all-flows-quarterly")
                .withHeaders(Arrays.asList(
                        "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 6, colStart: 0, colSpan: 63))",
                        "(Project Title: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 0, colSpan: 1));(MTEF 2008: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 1, colSpan: 1));(MTEF 2009: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 2, colSpan: 1));(MTEF 2010: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 3, colSpan: 1));(MTEF 2011: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 4, colSpan: 1));(MTEF 2012: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 5, colSpan: 1));(MTEF 2013: (startRow: 1, rowSpan: 5, totalRowSpan: 5, colStart: 6, colSpan: 1));(Real MTEF 2012: (startRow: 1, rowSpan: 4, totalRowSpan: 5, colStart: 7, colSpan: 2));(Real MTEF 2011: (startRow: 1, rowSpan: 4, totalRowSpan: 5, colStart: 9, colSpan: 2));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 5, colStart: 11, colSpan: 40));(Totals: (startRow: 1, rowSpan: 3, totalRowSpan: 5, colStart: 51, colSpan: 12))",
                        "(2010: (startRow: 2, rowSpan: 1, totalRowSpan: 4, colStart: 11, colSpan: 6));(2011: (startRow: 2, rowSpan: 1, totalRowSpan: 4, colStart: 17, colSpan: 4));(2013: (startRow: 2, rowSpan: 1, totalRowSpan: 4, colStart: 21, colSpan: 16));(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 4, colStart: 37, colSpan: 6));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 4, colStart: 43, colSpan: 8))",
                        "(Q1: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 11, colSpan: 3));(Total: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 14, colSpan: 3));(Q4: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 17, colSpan: 2));(Total: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 19, colSpan: 2));(Q2: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 21, colSpan: 3));(Q3: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 24, colSpan: 5));(Q4: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 29, colSpan: 2));(Total: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 31, colSpan: 6));(Q2: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 37, colSpan: 2));(Q4: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 39, colSpan: 2));(Total: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 41, colSpan: 2));(Q2: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 43, colSpan: 2));(Q3: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 45, colSpan: 2));(Q4: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 47, colSpan: 2));(Total: (startRow: 3, rowSpan: 1, totalRowSpan: 3, colStart: 49, colSpan: 2))",
                        "(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 13, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 14, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 15, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 16, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 17, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 19, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 20, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 21, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 22, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 23, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 24, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 25, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 26, colSpan: 3));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 29, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 30, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 31, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 32, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 33, colSpan: 4));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 37, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 38, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 39, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 40, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 41, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 42, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 43, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 44, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 45, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 46, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 47, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 48, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 49, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 50, colSpan: 1));(Actual Commitments: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 51, colSpan: 1));(Actual Disbursements: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 52, colSpan: 1));(Real Disbursements: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 53, colSpan: 5));(MTEF: (startRow: 4, rowSpan: 2, totalRowSpan: 2, colStart: 58, colSpan: 1));(Real MTEF: (startRow: 4, rowSpan: 1, totalRowSpan: 2, colStart: 59, colSpan: 4))",
                        "(EXEC-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(IMPL-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(EXEC-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(IMPL-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1));(DN-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 13, colSpan: 1));(DN-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 16, colSpan: 1));(IMPL-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 23, colSpan: 1));(DN-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 26, colSpan: 1));(EXEC-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 27, colSpan: 1));(IMPL-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 28, colSpan: 1));(DN-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 33, colSpan: 1));(EXEC-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 34, colSpan: 1));(IMPL-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 35, colSpan: 1));(IMPL-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 36, colSpan: 1));(DN-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 53, colSpan: 1));(DN-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 54, colSpan: 1));(EXEC-IMPL: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 55, colSpan: 1));(IMPL-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 56, colSpan: 1));(IMPL-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 57, colSpan: 1));(EXEC-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 59, colSpan: 1));(EXEC-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 60, colSpan: 1));(IMPL-BENF: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 61, colSpan: 1));(IMPL-EXEC: (startRow: 5, rowSpan: 1, totalRowSpan: 1, colStart: 62, colSpan: 1))"))
                .withWarnings(Arrays.asList())
                .withBody(      new ReportAreaForTests(null)
                        .withContents("Project Title", "", "MTEF 2008", "0", "MTEF 2009", "0", "MTEF 2010", "0", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "MTEF 2013", "158 654", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Funding-2010-Q1-Actual Commitments", "0", "Funding-2010-Q1-Actual Disbursements", "596 990", "Funding-2010-Q1-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Total-Actual Commitments", "0", "Funding-2010-Total-Actual Disbursements", "596 990", "Funding-2010-Total-Real Disbursements-DN-IMPL", "77 222", "Funding-2011-Q4-Actual Commitments", "999 888", "Funding-2011-Q4-Actual Disbursements", "0", "Funding-2011-Total-Actual Commitments", "999 888", "Funding-2011-Total-Actual Disbursements", "0", "Funding-2013-Q2-Actual Commitments", "0", "Funding-2013-Q2-Actual Disbursements", "0", "Funding-2013-Q2-Real Disbursements-IMPL-EXEC", "44 333", "Funding-2013-Q3-Actual Commitments", "0", "Funding-2013-Q3-Actual Disbursements", "545 000", "Funding-2013-Q3-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Q3-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Q3-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Q4-Actual Commitments", "570 000", "Funding-2013-Q4-Actual Disbursements", "35 000", "Funding-2013-Total-Actual Commitments", "570 000", "Funding-2013-Total-Actual Disbursements", "580 000", "Funding-2013-Total-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Total-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Total-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Total-Real Disbursements-IMPL-EXEC", "44 333", "Funding-2014-Q2-Actual Commitments", "0", "Funding-2014-Q2-Actual Disbursements", "45 000", "Funding-2014-Q4-Actual Commitments", "0", "Funding-2014-Q4-Actual Disbursements", "30 000", "Funding-2014-Total-Actual Commitments", "0", "Funding-2014-Total-Actual Disbursements", "75 000", "Funding-2015-Q2-Actual Commitments", "333 000", "Funding-2015-Q2-Actual Disbursements", "0", "Funding-2015-Q3-Actual Commitments", "678 456", "Funding-2015-Q3-Actual Disbursements", "0", "Funding-2015-Q4-Actual Commitments", "0", "Funding-2015-Q4-Actual Disbursements", "80 000", "Funding-2015-Total-Actual Commitments", "1 011 456", "Funding-2015-Total-Actual Disbursements", "80 000", "Totals-Actual Commitments", "2 581 344", "Totals-Actual Disbursements", "1 331 990", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-MTEF", "2 147 665", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500")
                        .withChildren(
                                new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Funding-2010-Q1-Actual Disbursements", "453 213", "Funding-2010-Total-Actual Disbursements", "453 213", "Funding-2011-Q4-Actual Commitments", "999 888", "Funding-2011-Total-Actual Commitments", "999 888", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                                new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "MTEF 2011", "150 000", "MTEF 2012", "65 000", "Funding-2010-Q1-Actual Disbursements", "143 777", "Funding-2010-Q1-Real Disbursements-DN-IMPL", "77 222", "Funding-2010-Total-Actual Disbursements", "143 777", "Funding-2010-Total-Real Disbursements-DN-IMPL", "77 222", "Funding-2013-Q2-Real Disbursements-IMPL-EXEC", "44 333", "Funding-2013-Total-Real Disbursements-IMPL-EXEC", "44 333", "Totals-Actual Disbursements", "143 777", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-MTEF", "215 000"),
                                new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project", "MTEF 2011", "33 888", "Totals-MTEF", "33 888"),
                                new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Funding-2013-Q3-Actual Disbursements", "545 000", "Funding-2013-Q3-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Q3-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Q3-Real Disbursements-IMPL-BENF", "15 000", "Funding-2013-Total-Actual Disbursements", "545 000", "Funding-2013-Total-Real Disbursements-DN-EXEC", "545 000", "Funding-2013-Total-Real Disbursements-EXEC-IMPL", "100 000", "Funding-2013-Total-Real Disbursements-IMPL-BENF", "15 000", "Totals-Actual Disbursements", "545 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000"),
                                new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1", "MTEF 2011", "789 123", "Totals-MTEF", "789 123"),
                                new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2", "MTEF 2013", "123 654", "Totals-MTEF", "123 654"),
                                new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Funding-2013-Q4-Actual Commitments", "570 000", "Funding-2013-Total-Actual Commitments", "570 000", "Totals-Actual Commitments", "570 000"),
                                new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "MTEF 2011", "700 000", "MTEF 2012", "150 000", "Funding-2015-Q2-Actual Commitments", "333 000", "Funding-2015-Q3-Actual Commitments", "555 000", "Funding-2015-Total-Actual Commitments", "888 000", "Totals-Actual Commitments", "888 000", "Totals-MTEF", "850 000"),
                                new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Funding-2015-Q3-Actual Commitments", "123 456", "Funding-2015-Total-Actual Commitments", "123 456", "Totals-Actual Commitments", "123 456", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500"),
                                new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "MTEF 2013", "35 000", "Funding-2013-Q4-Actual Disbursements", "35 000", "Funding-2013-Total-Actual Disbursements", "35 000", "Funding-2014-Q2-Actual Disbursements", "45 000", "Funding-2014-Q4-Actual Disbursements", "30 000", "Funding-2014-Total-Actual Disbursements", "75 000", "Totals-Actual Disbursements", "110 000", "Totals-MTEF", "35 000"),
                                new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "MTEF 2011", "45 000", "MTEF 2012", "56 000", "Funding-2015-Q4-Actual Disbursements", "80 000", "Funding-2015-Total-Actual Disbursements", "80 000", "Totals-Actual Disbursements", "80 000", "Totals-MTEF", "101 000")      ));
        
        runNiTestCase(cor, spec("AMP-22322-all-flows-quarterly"), flowsActs);
    }
        
    @Test
    public void testAllFlowsTotalsOnly() {
        NiReportModel cor = new NiReportModel("AMP-22322-all-flows-totals-only")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 4, colStart: 0, colSpan: 23))",
                    "(Project Title: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 0, colSpan: 1));(MTEF 2008: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 1, colSpan: 1));(MTEF 2009: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 2, colSpan: 1));(MTEF 2010: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 3, colSpan: 1));(MTEF 2011: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 4, colSpan: 1));(MTEF 2012: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 5, colSpan: 1));(MTEF 2013: (startRow: 1, rowSpan: 3, totalRowSpan: 3, colStart: 6, colSpan: 1));(Real MTEF 2012: (startRow: 1, rowSpan: 2, totalRowSpan: 3, colStart: 7, colSpan: 2));(Real MTEF 2011: (startRow: 1, rowSpan: 2, totalRowSpan: 3, colStart: 9, colSpan: 2));(Totals: (startRow: 1, rowSpan: 1, totalRowSpan: 3, colStart: 11, colSpan: 12))",
                    "(Actual Commitments: (startRow: 2, rowSpan: 2, totalRowSpan: 2, colStart: 11, colSpan: 1));(Actual Disbursements: (startRow: 2, rowSpan: 2, totalRowSpan: 2, colStart: 12, colSpan: 1));(Real Disbursements: (startRow: 2, rowSpan: 1, totalRowSpan: 2, colStart: 13, colSpan: 5));(MTEF: (startRow: 2, rowSpan: 2, totalRowSpan: 2, colStart: 18, colSpan: 1));(Real MTEF: (startRow: 2, rowSpan: 1, totalRowSpan: 2, colStart: 19, colSpan: 4))",
                    "(EXEC-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(IMPL-BENF: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 8, colSpan: 1));(EXEC-BENF: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(IMPL-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1));(DN-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 13, colSpan: 1));(DN-IMPL: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 14, colSpan: 1));(EXEC-IMPL: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 15, colSpan: 1));(IMPL-BENF: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 16, colSpan: 1));(IMPL-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 17, colSpan: 1));(EXEC-BENF: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 19, colSpan: 1));(EXEC-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 20, colSpan: 1));(IMPL-BENF: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 21, colSpan: 1));(IMPL-EXEC: (startRow: 3, rowSpan: 1, totalRowSpan: 1, colStart: 22, colSpan: 1))"))
                .withWarnings(Arrays.asList())
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "MTEF 2008", "0", "MTEF 2009", "0", "MTEF 2010", "0", "MTEF 2011", "1 718 011", "MTEF 2012", "271 000", "MTEF 2013", "158 654", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Totals-Actual Commitments", "2 581 344", "Totals-Actual Disbursements", "1 331 990", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-MTEF", "2 147 665", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(13), "Project Title", "TAC_activity_2", "Totals-Actual Commitments", "999 888", "Totals-Actual Disbursements", "453 213"),
                    new ReportAreaForTests(new AreaOwner(18), "Project Title", "Test MTEF directed", "MTEF 2011", "150 000", "MTEF 2012", "65 000", "Totals-Actual Disbursements", "143 777", "Totals-Real Disbursements-DN-IMPL", "77 222", "Totals-Real Disbursements-IMPL-EXEC", "44 333", "Totals-MTEF", "215 000"),
                    new ReportAreaForTests(new AreaOwner(19), "Project Title", "Pure MTEF Project", "MTEF 2011", "33 888", "Totals-MTEF", "33 888"),
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water", "Totals-Actual Disbursements", "545 000", "Totals-Real Disbursements-DN-EXEC", "545 000", "Totals-Real Disbursements-EXEC-IMPL", "100 000", "Totals-Real Disbursements-IMPL-BENF", "15 000"),
                    new ReportAreaForTests(new AreaOwner(25), "Project Title", "mtef activity 1", "MTEF 2011", "789 123", "Totals-MTEF", "789 123"),
                    new ReportAreaForTests(new AreaOwner(27), "Project Title", "mtef activity 2", "MTEF 2013", "123 654", "Totals-MTEF", "123 654"),
                    new ReportAreaForTests(new AreaOwner(33), "Project Title", "Activity with Zones", "Totals-Actual Commitments", "570 000"),
                    new ReportAreaForTests(new AreaOwner(70), "Project Title", "Activity with both MTEFs and Act.Comms", "MTEF 2011", "700 000", "MTEF 2012", "150 000", "Totals-Actual Commitments", "888 000", "Totals-MTEF", "850 000"),
                    new ReportAreaForTests(new AreaOwner(73), "Project Title", "activity with directed MTEFs", "Real MTEF 2012-EXEC-EXEC", "22 000", "Real MTEF 2012-IMPL-BENF", "43 000", "Real MTEF 2011-EXEC-BENF", "50 000", "Real MTEF 2011-IMPL-EXEC", "110 500", "Totals-Actual Commitments", "123 456", "Totals-Real MTEF-EXEC-BENF", "50 000", "Totals-Real MTEF-EXEC-EXEC", "22 000", "Totals-Real MTEF-IMPL-BENF", "43 000", "Totals-Real MTEF-IMPL-EXEC", "110 500"),
                    new ReportAreaForTests(new AreaOwner(76), "Project Title", "activity with pipeline MTEFs and act. disb", "MTEF 2013", "35 000", "Totals-Actual Disbursements", "110 000", "Totals-MTEF", "35 000"),
                    new ReportAreaForTests(new AreaOwner(78), "Project Title", "activity with many MTEFs", "MTEF 2011", "45 000", "MTEF 2012", "56 000", "Totals-Actual Disbursements", "80 000", "Totals-MTEF", "101 000")      ));
        
        runNiTestCase(cor, spec("AMP-22322-all-flows-totals-only"), flowsActs);
    }
    
    @Test
    public void testPlannedDisbursements() {
        NiReportModel cor = new NiReportModel("testRealPlannedDisbursements")
            .withHeaders(Arrays.asList(
                    "(RAW: (startRow: 0, rowSpan: 1, totalRowSpan: 5, colStart: 0, colSpan: 13))",
                    "(Project Title: (startRow: 1, rowSpan: 4, totalRowSpan: 4, colStart: 0, colSpan: 1));(Funding: (startRow: 1, rowSpan: 1, totalRowSpan: 4, colStart: 1, colSpan: 7));(Totals: (startRow: 1, rowSpan: 2, totalRowSpan: 4, colStart: 8, colSpan: 5))",
                    "(2014: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 1, colSpan: 2));(2015: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 3, colSpan: 3));(2016: (startRow: 2, rowSpan: 1, totalRowSpan: 3, colStart: 6, colSpan: 2))",
                    "(Planned Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 1, colSpan: 1));(Real Planned Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 2, colSpan: 1));(Planned Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 3, colSpan: 1));(Real Planned Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 4, colSpan: 2));(Planned Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 6, colSpan: 1));(Real Planned Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 7, colSpan: 1));(Planned Disbursements: (startRow: 3, rowSpan: 2, totalRowSpan: 2, colStart: 8, colSpan: 1));(Real Planned Disbursements: (startRow: 3, rowSpan: 1, totalRowSpan: 2, colStart: 9, colSpan: 4))",
                    "(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 2, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 4, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 5, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 7, colSpan: 1));(DN-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 9, colSpan: 1));(EXEC-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 10, colSpan: 1));(IMPL-BENF: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 11, colSpan: 1));(IMPL-EXEC: (startRow: 4, rowSpan: 1, totalRowSpan: 1, colStart: 12, colSpan: 1))"))
                .withWarnings(Arrays.asList())
                .withBody(      new ReportAreaForTests(null)
                  .withContents("Project Title", "", "Funding-2014-Planned Disbursements", "300", "Funding-2014-Real Planned Disbursements-IMPL-EXEC", "44,555", "Funding-2015-Planned Disbursements", "500", "Funding-2015-Real Planned Disbursements-EXEC-BENF", "88,777", "Funding-2015-Real Planned Disbursements-IMPL-BENF", "77,444", "Funding-2016-Planned Disbursements", "123,321", "Funding-2016-Real Planned Disbursements-DN-EXEC", "123,321", "Totals-Planned Disbursements", "124,121", "Totals-Real Planned Disbursements-DN-EXEC", "123,321", "Totals-Real Planned Disbursements-EXEC-BENF", "88,777", "Totals-Real Planned Disbursements-IMPL-BENF", "77,444", "Totals-Real Planned Disbursements-IMPL-EXEC", "44,555")
                  .withChildren(
                    new ReportAreaForTests(new AreaOwner(24), "Project Title", "Eth Water"),
                    new ReportAreaForTests(new AreaOwner(69), "Project Title", "Activity with planned disbursements", "Funding-2014-Planned Disbursements", "300", "Funding-2015-Planned Disbursements", "500", "Totals-Planned Disbursements", "800"),
                    new ReportAreaForTests(new AreaOwner(88), "Project Title", "activity-weird-funding", "Funding-2014-Real Planned Disbursements-IMPL-EXEC", "44,555", "Funding-2015-Real Planned Disbursements-EXEC-BENF", "88,777", "Funding-2015-Real Planned Disbursements-IMPL-BENF", "77,444", "Funding-2016-Planned Disbursements", "123,321", "Funding-2016-Real Planned Disbursements-DN-EXEC", "123,321", "Totals-Planned Disbursements", "123,321", "Totals-Real Planned Disbursements-DN-EXEC", "123,321", "Totals-Real Planned Disbursements-EXEC-BENF", "88,777", "Totals-Real Planned Disbursements-IMPL-BENF", "77,444", "Totals-Real Planned Disbursements-IMPL-EXEC", "44,555")      ));

        
        runNiTestCase(cor, 
            buildSpecification("testRealPlannedDisbursements", 
            Arrays.asList(ColumnConstants.PROJECT_TITLE),
            Arrays.asList(MeasureConstants.PLANNED_DISBURSEMENTS, MeasureConstants.REAL_PLANNED_DISBURSEMENTS), null, GroupingCriteria.GROUPING_YEARLY), 
            
            Arrays.asList("Eth Water", "activity-weird-funding", "Activity with planned disbursements"));
    }
}
