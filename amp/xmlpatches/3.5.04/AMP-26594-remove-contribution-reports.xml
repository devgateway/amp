<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true"
           xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../../doc/xmlpatcher.xsd ">
    <jira>AMP-26594</jira>
    <keyword>Remove Contribution Reports</keyword>
    <author>vchihai</author>
    <description>update amp offline compatibility to 1.5.0</description>
    <apply>
        <script>
            <lang delimiter=";" type="postgres"><![CDATA[

                DELETE FROM amp_fields_templates WHERE field IN (
                    SELECT id FROM amp_fields_visibility
                        WHERE name IN ('Costing Activity Id',
                        'Contribution Amount',
                        'Contribution Currency',
                        'Contribution Type of Assistance',
                        'Contribution Donors',
                        'Contribution Financing Type',
                        'Costing Activity Name',
                        'Costing Assumptions',
                        'Costing Contribution Gap',
                        'Costing Donor',
                        'Costing Due Date',
                        'Costing Grand Total Contribution',
                        'Costing Inputs',
                        'Costing Progress',
                        'Costing Total Contribution',
                        'Costing Total Cost',
                        'Costing Activity Id',
                        'Costing Tab',
                        'Add Costing Button',
                        'Proposed Project Cost',
                        'Total Costs',
                        'Grand Total Cost'
                        ));

                DELETE FROM amp_fields_visibility
                    WHERE name IN ('Costing Activity Id',
                        'Contribution Amount',
                        'Contribution Currency',
                        'Contribution Type of Assistance',
                        'Contribution Donors',
                        'Contribution Financing Type',
                        'Costing Activity Name',
                        'Costing Assumptions',
                        'Costing Contribution Gap',
                        'Costing Donor',
                        'Costing Due Date',
                        'Costing Grand Total Contribution',
                        'Costing Inputs',
                        'Costing Progress',
                        'Costing Total Contribution',
                        'Costing Total Cost',
                        'Costing Activity Id',
                        'Costing Tab',
                        'Add Costing Button',
                        'Proposed Project Cost',
                        'Total Costs',
                        'Grand Total Cost');

                DELETE FROM amp_features_templates WHERE feature IN (
                    SELECT id FROM amp_features_visibility
                    WHERE name IN ('Contribution Report', 'Costing'));

                DELETE FROM amp_features_visibility WHERE name IN ('Contribution Report', 'Costing');

                DELETE FROM amp_modules_templates WHERE module IN (
                    SELECT id FROM amp_modules_visibility
                    WHERE name = 'Activity Costing');

                DELETE FROM amp_modules_visibility WHERE name = 'Activity Costing';

                DROP VIEW IF EXISTS v_contribution_funding;
                DROP VIEW IF EXISTS v_financing_instrument;
                DROP VIEW IF EXISTS v_costs;
                DROP VIEW IF EXISTS v_costing_donors;

                DELETE FROM amp_report_column
                    WHERE columnid IN (SELECT columnid FROM amp_columns WHERE columnname IN ('Costing Donor', 'Grand Total', 'Grand Total Cost'));

                DELETE FROM amp_report_hierarchy
                    WHERE columnid IN (SELECT columnid FROM amp_columns WHERE columnname IN ('Costing Donor', 'Grand Total', 'Grand Total Cost'));

                DELETE FROM amp_columns
                    WHERE columnname IN ('Costing Donor', 'Grand Total', 'Grand Total Cost');

                DROP TABLE IF EXISTS amp_eu_activity_contribution CASCADE;
                DROP TABLE IF EXISTS amp_eu_activity CASCADE ;

                UPDATE amp_global_settings SET settingsvalue = 'true' WHERE settingsname='Recreate the views on the next server restart';

            ]]></lang>
		</script>
	</apply>
</tns:patch>
