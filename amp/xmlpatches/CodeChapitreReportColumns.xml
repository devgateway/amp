<?xml version="1.0" encoding="UTF-8"?>
<tns:patch closeOnSuccess="true" retryOnFail="true" xmlns:tns="http://docs.ampdev.net/schemas/xmlpatcher" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://docs.ampdev.net/schemas/xmlpatcher ../doc/xmlpatcher.xsd ">
  <jira>AMP-6255</jira>
  <keyword>chapitre</keyword>
  <keyword>reports</keyword>
  <keyword>imputation</keyword>
  <author>Mihai Postelnicu</author>
  <description>Niger asked to be able to add more than 1 line of codes for Activity Budget. They should be able to add as many lines as they need.Also they need just 2 Fields on each line: Imputation - with exactly 22 chars, and Code Chapitre - with exactly 11 chars.
  </description>
  <apply>	
    <script>
    <lang delimiter=";" type="mysql">
     delete from amp_report_hierarchy where columnId in (select columnId from amp_columns where columnName in ('Code Chapitre', 'Imputation'));
	 delete from amp_report_column where columnId in (select columnId from amp_columns where columnName in ('Code Chapitre', 'Imputation'));
     delete from amp_columns where columnName in ('Code Chapitre', 'Imputation');	
    INSERT INTO amp_columns(columnName, aliasName, description, cellType, extractorView, relatedContentPersisterClass, tokenExpression, filterRetrievable)
    VALUES 
    ('Budgeting Year', NULL, 'Code Chapitre - Budgeting Year', 'org.dgfoundation.amp.ar.cell.TextCell', 'v_budgeting_year', NULL, NULL, NULL),
    ('Code Chapitre', NULL, 'Code Chapitre', 'org.dgfoundation.amp.ar.cell.TextCell', 'v_code_chapitre', NULL, NULL, NULL),
    ('Description Chapitre', NULL, 'Code Chapitre - Description', 'org.dgfoundation.amp.ar.cell.TextCell', 'v_description_chapitre', NULL, NULL, NULL),
    ('Imputation', NULL, 'Code Chapitre - Imputation', 'org.dgfoundation.amp.ar.cell.TextCell', 'v_imputation', NULL, NULL, NULL),
    ('Description Imputation', NULL, 'Code Chapitre - Description Imputation', 'org.dgfoundation.amp.ar.cell.TextCell', 'v_description_imputation', NULL, NULL, NULL);
	</lang>
    </script>
    <script>
    	<lang delimiter=";" type="mysql">
    		CREATE OR REPLACE VIEW v_budgeting_year AS SELECT a.amp_activity_id,c.year FROM amp_chapter c, amp_activity a WHERE a.chapter_code=c.code;
    		CREATE OR REPLACE VIEW v_code_chapitre AS SELECT a.amp_activity_id,c.code FROM amp_chapter c, amp_activity a WHERE a.chapter_code=c.code;
			CREATE OR REPLACE VIEW v_description_chapitre AS SELECT a.amp_activity_id,c.description FROM amp_chapter c, amp_activity a WHERE a.chapter_code=c.code;
			CREATE OR REPLACE VIEW v_imputation AS SELECT a.amp_activity_id,i.code FROM amp_chapter c, amp_activity a,amp_imputation i WHERE a.chapter_code=c.code AND i.chapter_code=c.code;
			CREATE OR REPLACE VIEW v_description_imputation AS SELECT a.amp_activity_id,i.description FROM amp_chapter c, amp_activity a,amp_imputation i WHERE a.chapter_code=c.code AND i.chapter_code=c.code;
 		</lang>
 	</script>  
  </apply>
</tns:patch>
