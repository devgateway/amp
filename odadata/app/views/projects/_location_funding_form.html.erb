<script type="text/javascript" charset="utf-8">
	$('div.cofunding input[type=radio].donor').livequery('change', function() {
		if ($(this).checked) {
			$(this).nextAll('select.agencies').hide();
			$(this).nextAll('select.donors').show();
		} else {
			$(this).nextAll('select.donors').hide();
			$(this).nextAll('select.agencies').show();
		}
	});
	
	$('div.cofunding input[type=radio].agency').livequery('change', function() {
		if ($(this).checked) {
			$(this).nextAll('select.donors').hide();
			$(this).nextAll('select.agencies').show();
		} else {
			$(this).nextAll('select.agencies').hide();
			$(this).nextAll('select.donors').show();
		}
	});
</script>

<% f.field_set t('projects.geo_relevances_title') do %>
	<p><%=t 'projects.geo_usage' %></p>
	
	<li>
		<%= f.add_associated_button(t('projects.add_location'), @project.geo_relevances.new, :style => "display: block; float: right; margin-top: -10px; width: 170px") %>
		
		<%= error_message_on(:project, :geo_relevances, "","", "error_message" ) %>
		<div id="geo_relevances">
			<%= f.render_associated_form @project.geo_relevances, :new => 1 %>
  		</div>
	</li>
	
<% end %>

<% f.field_set t('projects.cofunding_title') do %>
	<li>
		<%= f.add_associated_button(t('projects.add_cofunding_donor'), @project.cofundings.new, :style => "display: block; float: right; margin-top: -5px; width: 170px", :partial => "cofunding_donor") %>
		<%= f.add_associated_button(t('projects.add_cofunding_agency'), @project.cofundings.new, :style => "display: block; float: right; margin-top: -5px; width: 170px", :partial => "cofunding_agency") %>
		
   	<%= error_message_on(:project, :cofundings, "","", "error_message" ) %>

		<div id="cofundings">
			<% @project.cofundings.each do |cofunding| %>
				<% f.fields_for :cofundings, cofunding do |cf| %>
					<% if cofunding.donor_type == "Donor" %>
						<%= render :partial => "cofunding_donor", :locals => { :f => cf } %>
					<% elsif cofunding.donor_type == "Agency" %>
						<%= render :partial => "cofunding_agency", :locals => { :f => cf } %>
					<% end %>
				<% end %>
			<% end %>
		</div>
	</li>
<% end %>
	
<% f.field_set t('projects.historic_funding', :year => Project::FIRST_YEAR_OF_RELEVANCE-1) do %>
	<% f.fields_for :historic_funding, HistoricFunding.find_or_initialize_by_project_id(@project.id) do |fh| %>
		<%= fh.hidden_field :currency, :value => @project.donor.currency -%>
	
		<li class="fifty"><%= fh.text_field :commitments, :value => fh.object.commitments %></li>
		<li class="fifty"><%= fh.text_field :payments, :value => fh.object.payments %></li>
	<% end %>
<% end %>

<% Project::FIRST_YEAR_OF_RELEVANCE.upto(Time.now.year) do |y| %>
	<% f.field_set t('projects.funding_title', :year => y) do %>
		<% f.fields_for :fundings, @project.fundings.find_or_initialize_by_year(y) do |fa| -%>
			<%= fa.hidden_field :year, :value => y %>
			<%= fa.hidden_field :currency, :value => @project.donor.currency %>
			
			<li><%= fa.text_field :commitments, :value => fa.object.commitments %></li>
			
			<li class="fifty"><%= fa.text_field :payments_q1, :value => fa.object.payments_q1 %></li>
			<li class="fifty"><%= fa.text_field :payments_q2, :value => fa.object.payments_q2 %></li>
			<li class="fifty"><%= fa.text_field :payments_q3, :value => fa.object.payments_q3 %></li>
			<li class="fifty"><%= fa.text_field :payments_q4, :value => fa.object.payments_q4 %></li>
			
			<li class="fifty noborder"><%= fa.select :on_budget, Project::ON_OFF_BUDGET_OPTIONS, :translate => true %></li>
			<li class="fifty noborder"><%= fa.select :on_treasury, Project::ON_OFF_TREASURY_OPTIONS, :translate => true %></li>
		<% end %>
	<% end %>
<% end %>
